{"version":3,"sources":["scrollload.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","_default","CONSTANT","_classCallCheck2","_createClass2","_defineProperty2","_uiUtil","selectorPrefix","ScrollLoad","el","config","arguments","length","undefined","distance","this","scrollEl","querySelector","concat","loadEl","emptyEl","errorEl","lock","events","Events","onScroll","bind","onEmptyClick","onErrorClick","addEventListener","key","_this","bottomHeight","scrollHeight","offsetHeight","scrollTop","hasType","Math","abs","style","display","trigger","done","status","EMPTY","ERROR","type","handler","on","remove","clear","clearAll","NORMAL"],"mappings":"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","file":"scrollload.js","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = _default;\nexports.CONSTANT = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _uiUtil = require(\"@ctmobile/ui-util\");\n\nvar selectorPrefix = 'ct-scrolload-';\n/**\r\n * ScrollLoad\r\n * @class ScrollLoad\r\n * @classdesc ScrollLoad\r\n */\n\nvar ScrollLoad =\n/*#__PURE__*/\nfunction () {\n  /**\r\n   * constructor\r\n   * @constructor\r\n   * @param {HtmlElement} el\r\n   * @param {object} config\r\n   * {\r\n   *  @param {number} distance 属性允许配置距页面底部（以px为单位）的距离以触发无限滚动事件。默认情况下，如果未指定，则为50（px）\r\n   * }\r\n   */\n  function ScrollLoad(el) {\n    var config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      distance: 50\n    };\n    (0, _classCallCheck2[\"default\"])(this, ScrollLoad);\n    this.el = el;\n    this.scrollEl = this.el.querySelector(\".\".concat(selectorPrefix, \"content\"));\n    this.loadEl = this.el.querySelector(\".\".concat(selectorPrefix, \"load\"));\n    this.emptyEl = this.el.querySelector(\".\".concat(selectorPrefix, \"empty\"));\n    this.errorEl = this.el.querySelector(\".\".concat(selectorPrefix, \"error\"));\n    this.config = config; // 锁\n\n    this.lock = false; // events\n\n    this.events = new _uiUtil.Events();\n    this.onScroll = this.onScroll.bind(this);\n    this.onEmptyClick = this.onEmptyClick.bind(this);\n    this.onErrorClick = this.onErrorClick.bind(this);\n    this.scrollEl.addEventListener('scroll', this.onScroll);\n    this.emptyEl.addEventListener('click', this.onEmptyClick);\n    this.errorEl.addEventListener('click', this.onErrorClick);\n  }\n  /**\r\n   * onScroll\r\n   */\n\n\n  (0, _createClass2[\"default\"])(ScrollLoad, [{\n    key: \"onScroll\",\n    value: function onScroll() {\n      var _this = this;\n\n      var bottomHeight = this.scrollEl.scrollHeight - this.scrollEl.offsetHeight;\n      var scrollTop = this.scrollEl.scrollTop;\n      /**\r\n       * 条件完全相等或误差值在1之间\r\n       */\n\n      if (this.events.hasType('scrollbottom') && Math.abs(scrollTop - bottomHeight) <= this.config.distance) {\n        if (this.lock) return;\n        this.lock = true; // 先显示loading\n\n        this.loadEl.style.display = 'flex';\n        this.events.trigger('scrollbottom', {\n          /**\r\n           * 完成\r\n           * @param {string} status [empty(没有数据) | error(有错误) | normal(正常)]\r\n           */\n          done: function done(status) {\n            _this.loadEl.style.display = 'none';\n\n            if (status === ScrollLoad.EMPTY) {\n              _this.emptyEl.style.display = 'block';\n            } else if (status === ScrollLoad.ERROR) {\n              _this.errorEl.style.display = 'block';\n            }\n\n            _this.lock = false;\n          }\n        });\n      }\n    }\n    /**\r\n     * onEmptyClick\r\n     */\n\n  }, {\n    key: \"onEmptyClick\",\n    value: function onEmptyClick() {\n      if (this.events.hasType('emptyclick')) {\n        this.events.trigger('emptyclick');\n      }\n    }\n    /**\r\n     * onErrorClick\r\n     */\n\n  }, {\n    key: \"onErrorClick\",\n    value: function onErrorClick() {\n      if (this.events.hasType('errorclick')) {\n        this.events.trigger('errorclick');\n      }\n    }\n    /**\r\n     * on 注册事件\r\n     * @param {string} type\r\n     *\r\n     * 1.滚动到了底部 scrollbottom\r\n     * 2.点击了没有数据 emptyclick\r\n     * 3.点击了错误 errorclick\r\n     *\r\n     * @param {Function} handler\r\n     */\n\n  }, {\n    key: \"on\",\n    value: function on(type, handler) {\n      this.events.on(type, handler);\n    }\n    /**\r\n     * 删除指定type下的事件或清除所有\r\n     * @param {string} type\r\n     * @param {Function} handler\r\n     */\n\n  }, {\n    key: \"off\",\n    value: function off(type, handler) {\n      if (type) {\n        if (handler) {\n          this.events.remove(type, handler);\n        } else {\n          this.events.clear(type);\n        }\n      } else {\n        this.events.clearAll();\n      }\n    }\n    /**\r\n     * getLoadEl\r\n     * @return {HtmlElement}\r\n     */\n\n  }, {\n    key: \"getLoadEl\",\n    value: function getLoadEl() {\n      return this.loadEl;\n    }\n    /**\r\n     * getEmptyEl\r\n     * @return {HtmlElement}\r\n     */\n\n  }, {\n    key: \"getEmptyEl\",\n    value: function getEmptyEl() {\n      return this.emptyEl;\n    }\n    /**\r\n     * getErrorEl\r\n     * @return {HtmlElement}\r\n     */\n\n  }, {\n    key: \"getErrorEl\",\n    value: function getErrorEl() {\n      return this.errorEl;\n    }\n    /**\r\n     * hideAll\r\n     */\n\n  }, {\n    key: \"hideAll\",\n    value: function hideAll() {\n      this.loadEl.style.display = 'none';\n      this.errorEl.style.display = 'none';\n      this.emptyEl.style.display = 'none';\n    }\n  }]);\n  return ScrollLoad;\n}();\n\n(0, _defineProperty2[\"default\"])(ScrollLoad, \"EMPTY\", 'empty');\n(0, _defineProperty2[\"default\"])(ScrollLoad, \"ERROR\", 'error');\n(0, _defineProperty2[\"default\"])(ScrollLoad, \"NORMAL\", 'normal');\nvar CONSTANT = {\n  EMPTY: ScrollLoad.EMPTY,\n  ERROR: ScrollLoad.ERROR,\n  NORMAL: ScrollLoad.NORMAL\n};\nexports.CONSTANT = CONSTANT;\n\n/**\r\n * ScrollLoad\r\n * @param {HtmlElement} el\r\n * @param {object} config\r\n * @return {ScrollLoad}\r\n */\nfunction _default(el, config) {\n  return new ScrollLoad(el, config);\n}"]}