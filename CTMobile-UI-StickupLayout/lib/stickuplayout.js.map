{"version":3,"sources":["stickuplayout.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","_default","_classCallCheck2","_createClass2","position","middle","target","val","this","innerEl","scrollTop","low","high","index","length","targetVal","start","end","preScrollObj","fixedEl","innerHTML","dom","outerHTML","events","change","createIndex","pre","i","len","headerEls","header","ranageStart","rangeEnd","offsetTop","offsetHeight","scrollHeight","push","scrollAnimationTo","targetTop","arguments","undefined","duration","self","key","initMask","call","maskEl","style","display","srcTop","scrollVal","setp","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","scrollTo","item","document","createElement","className","body","appendChild","initial","el","querySelector","querySelectorAll","addEventListener","StickupLayout","headerEl","type","handler"],"mappings":"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","file":"stickuplayout.js","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = _default;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\n/**\r\n * position 查找位置\r\n * @access private\r\n * @return {boolean}\r\n */\nfunction position() {\n  var val = this.innerEl.scrollTop;\n  var low = 0,\n      high = this.index.length - 1,\n      middle,\n      target;\n\n  while (low <= high && low <= this.index.length - 1 && high <= this.index.length - 1) {\n    middle = high + low >> 1;\n    var targetVal = this.index[middle];\n\n    if (val >= targetVal.start && val < targetVal.end) {\n      target = targetVal;\n      break;\n    } else if (val < targetVal.start) {\n      high = middle - 1;\n    } else {\n      low = middle + 1;\n    }\n  }\n\n  if (target) {\n    if (this.preScrollObj && this.preScrollObj.index === target.index) {\n      return false;\n    } else {\n      this.preScrollObj = target;\n      this.fixedEl.innerHTML = target.dom.outerHTML;\n\n      if (this.events.change) {\n        this.events.change(target.dom, target.index);\n      }\n    }\n  }\n}\n/**\r\n * position 创建索引\r\n * @access private\r\n */\n\n\nfunction createIndex() {\n  var pre = 0;\n  this.index = [];\n  this.preScrollObj = null;\n\n  for (var i = 0, len = this.headerEls.length; i < len; i++) {\n    var header = this.headerEls[i];\n    var ranageStart = pre,\n        rangeEnd = void 0;\n\n    if (i !== len - 1) {\n      rangeEnd = this.headerEls[i + 1].offsetTop - header.offsetHeight;\n    } else {\n      rangeEnd = this.innerEl.scrollHeight;\n    }\n\n    this.index.push({\n      start: ranageStart,\n      end: rangeEnd,\n      dom: header,\n      index: i\n    });\n    pre = rangeEnd;\n\n    if (pre > this.innerEl.scrollHeight - this.innerEl.offsetHeight) {\n      break;\n    }\n  }\n}\n/**\r\n * scrollAnimationTo\r\n * @access private\r\n * @param {number} targetTop\r\n * @param {number} duration\r\n */\n\n\nfunction scrollAnimationTo() {\n  var targetTop = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n  var duration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 300;\n  var self = this;\n  if (self.key) return;\n  initMask.call(self);\n  self.key = true;\n  this.maskEl.style.display = 'block';\n  var srcTop = this.innerEl.scrollTop,\n      scrollVal = srcTop,\n\n  /**\r\n   * 一次滚动的步进\r\n   * @type {number}\r\n   */\n  setp = this.innerEl.scrollHeight / (duration / (screen.updateInterval || 16.7) + (duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\n  /** *\r\n   * 动画的滚动\r\n   */\n\n  function scrollAnimation() {\n    if (srcTop < targetTop) {\n      if (scrollVal + setp > targetTop) {\n        scrollVal = targetTop;\n      } else {\n        scrollVal += setp;\n      }\n    } else if (scrollVal - setp < targetTop) {\n      scrollVal = targetTop;\n    } else {\n      scrollVal -= setp;\n    }\n\n    self.innerEl.scrollTop = scrollVal;\n\n    if (srcTop < targetTop) {\n      if (scrollVal >= targetTop) {\n        clear();\n      } else {\n        window.requestAnimationFrame(scrollAnimation);\n      }\n    } else if (scrollVal <= targetTop) {\n      clear();\n    } else {\n      window.requestAnimationFrame(scrollAnimation);\n    }\n\n    function clear() {\n      self.key = false;\n      self.maskEl.style.display = 'none';\n    }\n  }\n  /** *\r\n   * 滚动core\r\n   */\n\n\n  window.requestAnimationFrame(scrollAnimation);\n}\n/**\r\n * scrollTo\r\n * @access private\r\n * @param {Object} item\r\n * @param {number} duration\r\n */\n\n\nfunction scrollTo(item) {\n  var duration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 300;\n  var targetTop = item.start + this.headerEls[item.index].offsetHeight;\n\n  if (duration === 0) {\n    this.innerEl.scrollTop = targetTop;\n  } else {\n    scrollAnimationTo.call(this, targetTop, duration);\n  }\n}\n/**\r\n * initMask\r\n * @access private\r\n */\n\n\nfunction initMask() {\n  if (!this.maskEl) {\n    this.maskEl = document.createElement('div');\n    this.maskEl.className = 'ct-stickuplayout-mask';\n    window.document.body.appendChild(this.maskEl);\n  }\n}\n/**\r\n * position 初始化\r\n * @access private\r\n */\n\n\nfunction initial() {\n  var self = this;\n  this.key = false;\n  this.index = [];\n  this.events = {};\n  this.innerEl = this.el.querySelector('.ct-stickuplayout-inner');\n  this.fixedEl = this.el.querySelector('.ct-stickuplayout-fixed');\n  this.headerEls = this.el.querySelectorAll('.ct-stickuplayout-inner .ct-stickuplayout-item-header');\n  createIndex.call(this);\n  position.call(this);\n  this.innerEl.addEventListener('scroll', function () {\n    position.call(self);\n  });\n}\n/**\r\n * StickupLayout\r\n * @class StickupLayout\r\n * @classdesc StickupLayout\r\n */\n\n\nvar StickupLayout =\n/*#__PURE__*/\nfunction () {\n  function StickupLayout(el) {\n    (0, _classCallCheck2.default)(this, StickupLayout);\n    this.el = el;\n    initial.call(this);\n  }\n  /**\r\n   * scrollToByIndex\r\n   * @param {number} index\r\n   * @param {number} duration\r\n   * @return {boolean}\r\n   */\n\n\n  (0, _createClass2.default)(StickupLayout, [{\n    key: \"scrollToByIndex\",\n    value: function scrollToByIndex(index) {\n      var duration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 300;\n      var i = 0,\n          item;\n\n      for (; i < this.index.length; i++) {\n        if (this.index[i].index === index) {\n          item = this.index[i];\n          break;\n        }\n      }\n\n      if (!item) return false;\n      scrollTo.call(this, item, duration);\n    }\n    /**\r\n     * scrollToByHeaderEl\r\n     * @param {HtmlElement} headerEl\r\n     * @param {number} duration\r\n     * @return {boolean}\r\n     */\n\n  }, {\n    key: \"scrollToByHeaderEl\",\n    value: function scrollToByHeaderEl(headerEl) {\n      var duration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 300;\n      var i = 0,\n          item,\n          index = -1;\n\n      for (; i < this.index.length; i++) {\n        if (this.index[i].dom === headerEl) {\n          item = this.index[i];\n          index = i;\n          break;\n        }\n      }\n\n      if (!item) return false;\n      scrollTo.call(this, item, duration);\n    }\n    /**\r\n     * 刷新\r\n     */\n\n  }, {\n    key: \"refresh\",\n    value: function refresh() {\n      this.headerEls = this.el.querySelectorAll('.ct-stickuplayout-inner .ct-stickuplayout-item-header');\n      createIndex.call(this);\n      position.call(this);\n    }\n    /**\r\n     * 注册事件\r\n     * @param {string} type 事件类型\r\n     * @param {Function} handler 事件处理函数\r\n     */\n\n  }, {\n    key: \"on\",\n    value: function on(type, handler) {\n      this.events[type] = handler;\n    }\n  }]);\n  return StickupLayout;\n}();\n/**\r\n * StickupLayoutFactory\r\n * @param {HtmlElement} el\r\n * @return {StickupLayout}\r\n */\n\n\nfunction _default(el) {\n  return new StickupLayout(el);\n}"]}