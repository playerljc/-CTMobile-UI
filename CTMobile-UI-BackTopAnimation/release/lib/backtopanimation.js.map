{"version":3,"sources":["backtopanimation.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","_default","_classCallCheck2","_createClass2","_uiUtil","init","this","el","Dom6","createElement","parent","appendChild","initMask","maskEl","document","body","querySelector","initEvents","_this","self","addEventListener","key","style","display","srcTop","scrollEl","scrollTop","scrollVal","targetTop","setp","scrollHeight","duration","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","events","trigger","BackTopAnimation","Events","call","type","handler","on","remove","clearAll"],"mappings":"AAAA,aAEA,IAAIA,uBAAyBC,QAAQ,gDAErCC,OAAOC,eAAeC,QAAS,aAAc,CAC3CC,OAAO,IAETD,QAAQE,QAAUC,SAElB,IAAIC,iBAAmBR,uBAAuBC,QAAQ,0CAElDQ,cAAgBT,uBAAuBC,QAAQ,uCAE/CS,QAAUT,QAAQ,qBAMtB,SAASU,OACPC,KAAKC,GAAKH,QAAQI,KAAKC,cAAc,iDACrCH,KAAKI,OAAOC,YAAYL,KAAKC,IAQ/B,SAASK,WACPN,KAAKO,OAASC,SAASC,KAAKC,cAAc,+BAErCV,KAAKO,SACRP,KAAKO,OAAST,QAAQI,KAAKC,cAAc,kDACzCK,SAASC,KAAKJ,YAAYL,KAAKO,SASnC,SAASI,aACP,IAAIC,EAAQZ,KAERa,EAAOb,KAKXa,EAAKZ,GAAGa,iBAAiB,QAAS,WAChC,GAAID,EAAKE,IAAK,OAAO,EACrBF,EAAKE,KAAM,EACXH,EAAML,OAAOS,MAAMC,QAAU,QAC7B,IAAIC,EAASL,EAAKM,SAASC,UACvBC,EAAYH,EACZI,EAAY,EAEZC,EAAOV,EAAKM,SAASK,cAAgBX,EAAKY,UAAYC,OAAOC,gBAAkB,OAASd,EAAKY,UAAYC,OAAOC,gBAAkB,OAAU,EAAI,EAAI,IAuCxJC,OAAOC,sBAlCP,SAASC,IA2BP,SAASC,IACPlB,EAAKE,KAAM,EACXF,EAAKN,OAAOS,MAAMC,QAAU,OAC5BJ,EAAKmB,OAAOC,QAAQ,aA7BlBf,EAASI,EACYA,EAAnBD,EAAYE,EACdF,EAAYC,EAEZD,GAAaE,EAENF,EAAYE,EAAOD,EAC5BD,EAAYC,EAEZD,GAAaE,EAGfV,EAAKM,SAASC,UAAYC,EAEtBH,EAASI,EACMA,GAAbD,EACFU,IAEAH,OAAOC,sBAAsBC,GAEtBT,GAAaC,EACtBS,IAEAH,OAAOC,sBAAsBC,OAWhC,GAKHjB,EAAKM,SAASL,iBAAiB,SAAU,WAChB,IAAnBd,KAAKoB,UACPQ,OAAOC,sBAAsB,WAC3BhB,EAAKZ,GAAGe,MAAMC,QAAU,UAG1BW,OAAOC,sBAAsB,WAC3BhB,EAAKZ,GAAGe,MAAMC,QAAU,WAG3B,GASL,IAAIiB,iBAEJ,WACE,SAASA,EAAiB9B,EAAQe,IAChC,EAAIvB,iBAAiBF,SAASM,KAAMkC,GACpClC,KAAKI,OAASA,EACdJ,KAAKmB,SAAWA,EAEhBnB,KAAKe,KAAM,EACXf,KAAKyB,SAAW,IAEhBzB,KAAKgC,OAAS,IAAIlC,QAAQqC,OAC1BpC,KAAKqC,KAAKpC,MACVM,SAAS8B,KAAKpC,MACdW,WAAWyB,KAAKpC,MAkClB,OAzBA,EAAIH,cAAcH,SAASwC,EAAkB,CAAC,CAC5CnB,IAAK,KACLtB,MAAO,SAAY4C,EAAMC,GACvBtC,KAAKgC,OAAOO,GAAGF,EAAMC,KAQtB,CACDvB,IAAK,MACLtB,MAAO,SAAa4C,EAAMC,GACpBD,EACEC,EACFtC,KAAKgC,OAAOQ,OAAOH,EAAMC,GAEzBtC,KAAKgC,OAAOD,MAAMM,GAGpBrC,KAAKgC,OAAOS,eAIXP,EA9CT,GAwDA,SAASvC,SAASS,EAAQe,GACxB,OAAO,IAAIe,iBAAiB9B,EAAQe","file":"backtopanimation.js","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = _default;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _uiUtil = require(\"@ctmobile/ui-util\");\n\n/**\r\n * init\r\n * @access private\r\n */\nfunction init() {\n  this.el = _uiUtil.Dom6.createElement('<div class=\"ct-scrollTopAnimation-btn\"></div>');\n  this.parent.appendChild(this.el);\n}\n/**\r\n * initMask\r\n * @access private\r\n */\n\n\nfunction initMask() {\n  this.maskEl = document.body.querySelector('.ct-scrollTopAnimation-mask');\n\n  if (!this.maskEl) {\n    this.maskEl = _uiUtil.Dom6.createElement(\"<div class='ct-scrollTopAnimation-mask'></div>\");\n    document.body.appendChild(this.maskEl);\n  }\n}\n/**\r\n * initEvents\r\n * @access private\r\n */\n\n\nfunction initEvents() {\n  var _this = this;\n\n  var self = this;\n  /**\r\n   * 点击操作按钮\r\n   */\n\n  self.el.addEventListener('click', function () {\n    if (self.key) return false;\n    self.key = true;\n    _this.maskEl.style.display = 'block';\n    var srcTop = self.scrollEl.scrollTop;\n    var scrollVal = srcTop;\n    var targetTop = 0; // 一次滚动的步进\n\n    var setp = self.scrollEl.scrollHeight / (self.duration / (screen.updateInterval || 16.7) + (self.duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\n    /**\r\n     * 动画的滚动\r\n     */\n\n    function scrollAnimation() {\n      if (srcTop < targetTop) {\n        if (scrollVal + setp > targetTop) {\n          scrollVal = targetTop;\n        } else {\n          scrollVal += setp;\n        }\n      } else if (scrollVal - setp < targetTop) {\n        scrollVal = targetTop;\n      } else {\n        scrollVal -= setp;\n      }\n\n      self.scrollEl.scrollTop = scrollVal;\n\n      if (srcTop < targetTop) {\n        if (scrollVal >= targetTop) {\n          clear();\n        } else {\n          window.requestAnimationFrame(scrollAnimation);\n        }\n      } else if (scrollVal <= targetTop) {\n        clear();\n      } else {\n        window.requestAnimationFrame(scrollAnimation);\n      }\n\n      function clear() {\n        self.key = false;\n        self.maskEl.style.display = 'none';\n        self.events.trigger('scrollTop');\n      }\n    }\n\n    window.requestAnimationFrame(scrollAnimation);\n  }, false);\n  /**\r\n   * 滚动的event\r\n   */\n\n  self.scrollEl.addEventListener('scroll', function () {\n    if (this.scrollTop !== 0) {\n      window.requestAnimationFrame(function () {\n        self.el.style.display = 'block';\n      });\n    } else {\n      window.requestAnimationFrame(function () {\n        self.el.style.display = 'none';\n      });\n    }\n  }, false);\n}\n/**\r\n * BackTopAnimation\r\n * @class BackTopAnimation\r\n * @classdesc BackTopAnimation\r\n */\n\n\nvar BackTopAnimation =\n/*#__PURE__*/\nfunction () {\n  function BackTopAnimation(parent, scrollEl) {\n    (0, _classCallCheck2.default)(this, BackTopAnimation);\n    this.parent = parent;\n    this.scrollEl = scrollEl; // 执行动画时的锁\n\n    this.key = false;\n    this.duration = 300; // events\n\n    this.events = new _uiUtil.Events();\n    init.call(this);\n    initMask.call(this);\n    initEvents.call(this);\n  }\n  /**\r\n   * on 注册事件\r\n   * @param {string} type\r\n   * @param {Function} handler\r\n   */\n\n\n  (0, _createClass2.default)(BackTopAnimation, [{\n    key: \"on\",\n    value: function on(type, handler) {\n      this.events.on(type, handler);\n    }\n    /**\r\n     * 删除指定type下的事件或清除所有\r\n     * @param {string} type\r\n     * @param {Function} handler\r\n     */\n\n  }, {\n    key: \"off\",\n    value: function off(type, handler) {\n      if (type) {\n        if (handler) {\n          this.events.remove(type, handler);\n        } else {\n          this.events.clear(type);\n        }\n      } else {\n        this.events.clearAll();\n      }\n    }\n  }]);\n  return BackTopAnimation;\n}();\n/**\r\n * BackTopAnimationFactory\r\n * @param {HtmlElement} el\r\n * @param {HTMLElement} scrollEl\r\n * @return {BackTopAnimation}\r\n */\n\n\nfunction _default(parent, scrollEl) {\n  return new BackTopAnimation(parent, scrollEl);\n}"]}