"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_uiUtil=require("@ctmobile/ui-util"),selectorPrefix="ct-tree-",normalTriggerIcon="fa fa-caret-right",remoteTriggerIcon="fa fa-spinner",checkboxIcon={checkall:"check-square",uncheckall:"minus-square",unchecked:"square-o"},radioIcon={checked:"circle",unchecked:"circle-o"};function initVar(){this.itemEl=this.el.querySelector(".".concat(selectorPrefix,"item")),this.itemTriggerEl=this.itemEl.querySelector(".".concat(selectorPrefix,"item-trigger")),this.itemIconEl=this.itemEl.querySelector(".".concat(selectorPrefix,"item-icon")),this.itemLabelEl=this.itemEl.querySelector(".".concat(selectorPrefix,"item-label")),this.itemTextEl=this.itemLabelEl.querySelector(".".concat(selectorPrefix,"item-text")),this.itemInputEl=this.itemEl.querySelector(".".concat(selectorPrefix,"item-input")),this.itemInputFieldEl=this.itemEl.querySelector(".".concat(selectorPrefix,"item-input-field")),this.childrenEl=this.el.querySelector(".".concat(selectorPrefix,"children"))}function initEvents(){var e=this,t=this.config.loadType;this.itemTriggerEl&&this.itemTriggerEl.addEventListener("click",function(){if(e.extend)_expand.call(e,!e.isExpand);else if("remote"===t)if(e.isload)_expand.call(e,!e.isExpand);else{if(e.lock)return!1;e.lock=!0,changeRemoteIcon.call(e),e.events.trigger("loadRemote",e,onLoadRemoteSuccess.bind(e),onLoadRemoteError.bind(e),onLoadRemoteComplete.bind(e))}else _expand.call(e,!e.isExpand)}),this.itemLabelEl.addEventListener("click",function(){e.events.trigger("click",e)}),this.itemInputEl&&this.itemInputEl.addEventListener("click",function(){e.isChecked()?"checkbox"===e.getType()&&e.checked(!1):"checkbox"===e.getType()&&e.checked(!0)})}function checked(e){if(this.isCheckboxType()&&"checkbox"===this.getType()){this.itemInputFieldEl.checked=e;var t=this.config.checkedCascade;if((void 0===t||t)&&!this.isLeaf())for(var i=0;i<this.childrenNodes.length;i++){this.childrenNodes[i].checked(e)}}}function checkedDetail(e){checked.call(this,e),this.detailItemInputsRecursive(),this.events.trigger("checked",this,e)}function changeRemoteIcon(){_uiUtil.Dom6.removeClass(this.itemTriggerEl,normalTriggerIcon),_uiUtil.Dom6.addClass(this.itemTriggerEl,"".concat(remoteTriggerIcon," animation"))}function getChildrenPaddingLeft(){var e=this.config,t=e.leaf,i=e.type,n=e.icon,c=4;return t||(c+=22),"normal"!==i?c+=n?19:22:n&&(c+=19),c}function changeNormalIcon(){_uiUtil.Dom6.removeClass(this.itemTriggerEl,"".concat(remoteTriggerIcon," animation")),_uiUtil.Dom6.addClass(this.itemTriggerEl,normalTriggerIcon)}function _expand(e){return!this.isLeaf()&&(this.isExpand!==e&&(e?_uiUtil.Dom6.addClass(this.el,"expand"):_uiUtil.Dom6.removeClass(this.el,"expand"),this.isExpand=e,void this.events.trigger("expand",this,this.isExpand)))}function onLoadRemoteSuccess(e){var t=this.nodeGlobalConfig,i=this.nodeConfig;e.length<=0&&(i.leaf=!0,this.itemTriggerEl.classList.add("invisible")),this.childrenNodes=[],i.children=e,this.tree.renderChildren({parentNode:this,globalConfig:t,config:i}),_expand.call(this,!0),changeNormalIcon.call(this),this.isload=!0,this.refresh(),this.lock=!1}function onLoadRemoteError(){changeNormalIcon.call(this),this.lock=!1}function onLoadRemoteComplete(){changeNormalIcon.call(this),this.lock=!1}function renderInput(){var e=this.config,t=e.type,i=e.checked,n=void 0!==i&&i,c=e.leaf;if("normal"===t)return"";if("checkbox"!==t)return"radio"===t?'<span class="'.concat(selectorPrefix,"item-input fa fa-").concat(radioIcon.unchecked,'" >\n             <input class="').concat(selectorPrefix,'item-input-field" type="checkbox" />\n            </span>'):"";return c&&n?'<span class="'.concat(selectorPrefix,"item-input fa fa-").concat(checkboxIcon.checkall,'" >\n              <input class="').concat(selectorPrefix,'item-input-field" checked type="checkbox" />\n             </span>'):'<span class="'.concat(selectorPrefix,"item-input fa fa-").concat(checkboxIcon.unchecked,'" >\n              <input class="').concat(selectorPrefix,'item-input-field" type="checkbox" />\n             </span>')}function renderCheckboxCheckAll(){_uiUtil.Dom6.removeClass(this.itemInputEl,"fa-".concat(checkboxIcon.uncheckall," fa-").concat(checkboxIcon.unchecked)),_uiUtil.Dom6.addClass(this.itemInputEl,"fa-".concat(checkboxIcon.checkall)),this.events.trigger("checked",this,!0)}function renderCheckboxUncheckall(){_uiUtil.Dom6.removeClass(this.itemInputEl,"fa-".concat(checkboxIcon.checkall," fa-").concat(checkboxIcon.unchecked)),_uiUtil.Dom6.addClass(this.itemInputEl,"fa-".concat(checkboxIcon.uncheckall)),this.events.trigger("checked",this,!1)}function renderCheckboxUnchecked(){_uiUtil.Dom6.removeClass(this.itemInputEl,"fa-".concat(checkboxIcon.checkall," fa-").concat(checkboxIcon.uncheckall)),_uiUtil.Dom6.addClass(this.itemInputEl,"fa-".concat(checkboxIcon.unchecked)),this.events.trigger("checked",this,!1)}function render(){var e=this.config,t=e.label,i=e.leaf,n=e.icon,c=e.iconColor,o=e.attr,r=void 0===o?{}:o;this.el=_uiUtil.Dom6.createElement('<div class="'.concat(selectorPrefix,"node ").concat(this.isExpand?"expand":"",'">\n        <div class="').concat(selectorPrefix,'item">\n          <span class="').concat(selectorPrefix,"item-trigger ").concat(i?"invisible":""," ").concat(normalTriggerIcon,'"></span>\n          ').concat(renderInput.call(this),'\n          <span class="').concat(selectorPrefix,"item-icon fa fa-").concat(n," ").concat(n?"":"invisible",'" style="color:').concat(c||"",'"></span>\n          <span class="').concat(selectorPrefix,'item-label">\n            <span class="').concat(selectorPrefix,'item-text">').concat(t,"</span>\n          </span>\n        </div>\n      </div>\n    ")),_uiUtil.Dom6.objectToDataSet(r,this.el),initVar.call(this),initEvents.call(this)}var TreeNode=function(){function a(e){var t=e.globalConfig,i=e.config,n=e.tree,c=e.parentNode;(0,_classCallCheck2.default)(this,a),this.nodeGlobalConfig=JSON.parse(JSON.stringify(t)),this.nodeConfig=JSON.parse(JSON.stringify(i)),this.config=JSON.parse(JSON.stringify(Object.assign({},t,i))),this.tree=n,this.parentNode=c,this.childrenNodes=[],this.isload=!1,this.lock=!1,this.events=n.events;var o=this.config,r=o.expand,l=void 0===r||r,s=o.loadType;this.isExpand="remote"!==s&&l,render.call(this)}return(0,_createClass2.default)(a,[{key:"append",value:function(e,t){var i=1<arguments.length&&void 0!==t&&t,n=this.config.loadType;if(this.isLeaf()){this.childrenEl=_uiUtil.Dom6.createElement('<div class="ct-tree-children"></div>');var c=getChildrenPaddingLeft.call(this);this.childrenEl.style.paddingLeft="".concat(c,"px"),this.el.appendChild(this.childrenEl)}this.childrenEl.appendChild(e.getEl()),this.childrenNodes.push(e),_uiUtil.Dom6.removeClass(this.itemTriggerEl,"invisible"),"remote"!==n||this.isload||(this.isload=!0),i&&this.refresh()}},{key:"appendByConfig",value:function(e){var t=this.nodeGlobalConfig,i=new a({globalConfig:t,config:e,tree:this.tree,parentNode:this});this.tree.renderChildren({parentNode:i,globalConfig:t,config:e}),this.append(i),this.refresh()}},{key:"prepend",value:function(e){this.isLeaf()&&this.append(e),_uiUtil.Dom6.prepend(this.childrenEl,e.getEl()),this.childrenNodes.unshift(e),this.refresh()}},{key:"prependByConfig",value:function(e){var t=this.nodeGlobalConfig,i=new a({globalConfig:t,config:e,tree:this.tree,parentNode:this});this.tree.renderChildren({parentNode:i,globalConfig:t,config:e}),this.prepend(i)}},{key:"insertBefore",value:function(t,e){if(!t||!e)return!1;var i=this.childrenNodes.findIndex(function(e){return e===t});-1===i?(this.append(e),this.refresh()):0===i?this.prepend(e):(this.childrenEl.insertBefore(e.getEl(),t.getEl()),this.childrenNodes.splice(i,0,e),this.refresh())}},{key:"insertBeforeByConfig",value:function(e,t){var i=this.nodeGlobalConfig,n=new a({globalConfig:i,config:t,tree:this.tree,parentNode:this});this.tree.renderChildren({parentNode:n,globalConfig:i,config:t}),this.insertBefore(e,n)}},{key:"insertAfter",value:function(t,e){if(!t||!e)return!1;var i=this.childrenNodes.findIndex(function(e){return e===t});-1===i?(this.append(e),this.refresh()):i===this.childrenNodes.length-1?this.prepend(e):(_uiUtil.Dom6.insertAfter(e.getEl(),t.getEl()),this.childrenNodes.splice(i+1,0,e),this.refresh())}},{key:"insertAfterByConfig",value:function(e,t){var i=this.nodeGlobalConfig,n=new a({globalConfig:i,config:t,tree:this.tree,parentNode:this});this.tree.renderChildren({parentNode:n,globalConfig:i,config:t}),this.insertAfter(e,n)}},{key:"replaceNode",value:function(t,e){if(!t||!e)return!1;var i=this.childrenNodes.findIndex(function(e){return e===t});if(-1===i)return!1;this.childrenEl.replaceChild(e.getEl(),t.getEl()),this.childrenNodes.splice(i,1,e),this.refresh()}},{key:"replaceNodeByConfig",value:function(e,t){var i=this.nodeGlobalConfig,n=new a({globalConfig:i,config:t,tree:this.tree,parentNode:this});this.tree.renderChildren({parentNode:n,globalConfig:i,config:t}),this.replaceNode(e,n)}},{key:"removeChildren",value:function(t){if(!t)return!1;if(this.isLeaf())return!1;var e=this.childrenNodes.findIndex(function(e){return e===t});if(-1===e)return!1;this.childrenNodes.splice(e,1),_uiUtil.Dom6.remove(t.getEl()),this.isLeaf()&&_uiUtil.Dom6.addClass(this.itemTriggerEl,"invisible"),this.refresh()}},{key:"childrens",value:function(){return[].concat(this.childrenNodes)}},{key:"expand",value:function(e){_expand.call(this,e)}},{key:"resetRemoteNode",value:function(){if("remote"!==this.config.loadType)return!1;this.expand(!1),this.isload=!1}},{key:"isExpand",value:function(){return this.isExpand}},{key:"getAttr",value:function(e){return this.el.dataset[e]}},{key:"setAttr",value:function(e,t){this.el.dataset[e]=t}},{key:"hasAttr",value:function(e,t){return t===this.getAttr(e)}},{key:"getLabel",value:function(){return this.itemTextEl.innerText}},{key:"setLabel",value:function(e){this.itemTextEl.innerText=e}},{key:"setIcon",value:function(e){var t=this,i=this.config,n=i.icon,c=i.iconColor;function o(){t.config.icon=e,t.itemIconEl=_uiUtil.Dom6.createElement('<span class="'.concat(selectorPrefix,"item-icon fa fa-").concat(e,'" style="color:').concat(c||"",'"></span>')),_uiUtil.Dom6.prepend(t.itemLabelEl,t.itemIconEl)}n&&this.itemIconEl?(this.config.icon=e,_uiUtil.Dom6.removeClass(this.itemIconEl,"fa fa-".concat(n)),_uiUtil.Dom6.addClass(this.itemIconEl,"fa fa-".concat(e))):o()}},{key:"getIcon",value:function(){return this.config.icon}},{key:"setIconColor",value:function(e){return!!this.config.icon&&(!!this.itemIconEl&&(this.config.iconColor=e,void(this.itemIconEl.style.color=e)))}},{key:"getIconColor",value:function(){return this.config.iconColor}},{key:"isLeaf",value:function(){return this.childrenNodes.length<=0}},{key:"isRoot",value:function(){return!!this.parentNode}},{key:"getEl",value:function(){return this.el}},{key:"isChecked",value:function(){return!!this.isCheckboxType()&&(!!this.itemInputFieldEl&&this.itemInputFieldEl.checked)}},{key:"getType",value:function(){return this.config.type}},{key:"getParentNode",value:function(){return this.parentNode}},{key:"isCheckboxType",value:function(){return-1!==["checkbox","radio"].indexOf(this.config.type)}},{key:"checkboxDrillUp",value:function(){if(!this.isCheckboxType())return!1;for(var e=[],t=0;t<this.childrenNodes.length;t++){var i=this.childrenNodes[t];i.itemInputFieldEl&&e.push(i)}var n=e.filter(function(e){return e.isChecked()});n.length===e.length?(this.itemInputFieldEl.checked=!0,renderCheckboxCheckAll.call(this),this.events.trigger("checked",this,!0)):(this.itemInputFieldEl.checked=!1,0!==n.length?renderCheckboxUncheckall.call(this):renderCheckboxUnchecked.call(this),this.events.trigger("checked",this,!1)),this.parentNode&&this.parentNode.checkboxDrillUp()}},{key:"detailItemInputsRecursive",value:function(){var e=this.config.checkedCascade;if(void 0===e||e)if(this.isLeaf()){if("checkbox"===this.getType()){this.isChecked()?renderCheckboxCheckAll.call(this):renderCheckboxUnchecked.call(this);var t=this.getParentNode();t&&t.checkboxDrillUp()}}else for(var i=this.childrens(),n=0;n<i.length;n++)i[n].detailItemInputsRecursive();else this.isChecked()?renderCheckboxCheckAll.call(this):renderCheckboxUnchecked.call(this)}},{key:"checked",value:function(e){this.events.hasType("beforeChecked")?this.events.trigger("beforeChecked",this,e)&&checkedDetail.call(this,e):checkedDetail.call(this,e)}},{key:"refresh",value:function(){var e=this.getParentNode();e?e.detailItemInputsRecursive():this.detailItemInputsRecursive()}}]),a}(),_default=TreeNode;exports.default=_default;
//# sourceMappingURL=treenode.js.map
