"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),selectorPrefix="ct-drag-";function initEvents(){initDragSourceEvent.call(this)}function initDragSourceEvent(){var l=this,n=this,e=n.config,t=e.dragSourceExtendClasses,s=void 0===t?[]:t,i=e.onDragClone,r=e.onPutSuccess,o=e.isDragSourceExist,c=void 0===o||o,a=e.isDragSourceDisplay,u=void 0===a||a;n.sourceEventHanlder=new WeakMap;for(var h=function(e){var o=l.sourceEls[e],t={};o.addEventListener("touchstart",function(){function l(){var e=o.cloneNode(!0);return s?e.className+=" ".concat(s.join(" ")):e.style.border="1px dashed black",e}var e=function(e){n.isdown=!0;var t=(n.sourceEl=o).getBoundingClientRect();n.baseX=t.left,n.baseY=t.top,n.firstX=e.touches[0].pageX,n.firstY=e.touches[0].pageY,i?(n.cloneEl=i(o),n.cloneEl||(n.cloneEl=l())):n.cloneEl=l(),n.cloneEl.setAttribute("id",""),n.cloneEl.style.minWidth="".concat(o.offsetWidth,"px"),n.cloneEl.style.minHeight="".concat(o.offsetHeight,"px"),n.cloneEl.style.position="fixed",n.cloneEl.style.zIndex="9999",n.cloneEl.style.left="".concat(n.baseX,"px"),n.cloneEl.style.top="".concat(n.baseY,"px"),n.cloneEl.style.margin="0",document.body.appendChild(n.cloneEl)};return t.mousedown=e}()),o.addEventListener("touchmove",function(e){if(!n.isdown)return!1;n.ismove||(n.ismove=!0,u&&c||(n.sourceEl.style.visibility="hidden"));var t=e.touches[0].pageX,l=e.touches[0].pageY;getMoveInTargetEls.call(n);var o=t-n.firstX,s=l-n.firstY;n.cloneEl.style.left="".concat(n.baseX+o,"px"),n.cloneEl.style.top="".concat(n.baseY+s,"px")}),o.addEventListener("touchend",function(){if(!n.ismove)return reset.call(n),!1;var e=getMoveInTargetEls.call(n);if(0<e.complete.length){if(r){var t=n.cloneEl.getBoundingClientRect(),l=n.sourceEl.cloneNode(!0);l.style.visibility="visible",l.style.cursor="default",r({cloneSourceEl:l,sourceEl:o,targetEls:e.complete,rect:{left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width,height:t.height,x:t.x,y:t.y}})?(n.config.isDragSourceExist||n.sourceEl&&(n.sourceEl.parentElement.removeChild(n.sourceEl),n.sourceEl=null),reset.call(n,e.complete)):goBack.call(n,n.sourceEl,e.complete)}}else goBack.call(n,n.sourceEl,e.section)}),n.sourceEventHanlder.set(o,t)},f=0;f<this.sourceEls.length;f++)h(f)}function getMoveInTargetEls(){for(var o=this,s=[],n=[],i=this.cloneEl.getBoundingClientRect(),e=this.config.dragTargetExtendClasses,r=void 0===e?[]:e,t=function(e){var t=o.targetEls[e],l=o.targetsIndex.get(t);(i.left>=l.left&&i.left<=l.right||i.right>=l.left&&i.right<=l.right)&&(i.top>=l.top&&i.top<=l.bottom||i.bottom>=l.top&&i.bottom<=l.bottom)?(r?(r.map(function(e){e&&t.classList.remove(e)}),t.className+=" ".concat(r.join(" "))):t.style.border="2px dashed black",i.left>=l.left&&i.left<=l.right&&i.right>=l.left&&i.right<=l.right&&i.top>=l.top&&i.top<=l.bottom&&i.bottom>=l.top&&i.bottom<=l.bottom?s.push(t):n.push(t)):r?r.map(function(e){e&&t.classList.remove(e)}):t.style.border="0"},l=0;l<this.targetEls.length;l++)t(l);return{complete:s,section:n}}function goBack(t,l){var o=this,e=this.config.noDragReturnAnimate;void 0!==e&&e?setTimeout(function(){o.isdown=!1,o.cloneEl.addEventListener("transitionend",function e(){o.cloneEl.removeEventListener("transitionend",e),reset.call(o,l),t.style.visibility="visible"}),o.cloneEl.style.transition="all .25s ease-out",o.cloneEl.style.transform="translateZ(0)";var e=t.getBoundingClientRect();o.cloneEl.style.left="".concat(e.left,"px"),o.cloneEl.style.top="".concat(e.top,"px")},100):(reset.call(o,l),t.style.visibility="visible")}function reset(l){var e=this,t=this.config.dragTargetExtendClasses,o=void 0===t?[]:t;if(e.cloneEl&&document.body.removeChild(e.cloneEl),l&&0<l.length)for(var s=function(t){o?o.map(function(e){e&&l[t].classList.remove(e)}):l[t].style.border="0"},n=0;n<l.length;n++)s(n);e.isdown=!1,e.ismove=!1,e.baseX=null,e.baseY=null,e.firstX=null,e.firstY=null,e.cloneEl=null,e.sourceEl=null}var DragTouch=function(){function l(e,t){(0,_classCallCheck2.default)(this,l),this.el=e,this.config=Object.assign({},t),this.sourceEls=this.el.querySelectorAll(".".concat(selectorPrefix,"source")),this.targetEls=this.el.querySelectorAll(".".concat(selectorPrefix,"target")),this.config=Object.assign({},t),this.isdown=!1,this.ismove=!1,this.baseX=null,this.baseY=null,this.firstX=null,this.firstY=null,this.cloneEl=null,this.sourceEl=null,initEvents.call(this)}return(0,_createClass2.default)(l,[{key:"refresh",value:function(){for(var e=0;e<this.sourceEls.length;e++){var t=this.sourceEls[e],l=this.sourceEventHanlder.get(t);for(var o in l)t.removeEventListener(o,l[o])}this.sourceEls=document.querySelectorAll(".".concat(selectorPrefix,"source")),this.targetEls=this.el.querySelectorAll(".".concat(selectorPrefix,"target")),initDragSourceEvent.call(this)}}]),l}(),DragTouchFactory={create:function(e,t){return new DragTouch(e,t)}},_default=DragTouchFactory;exports.default=_default;
//# sourceMappingURL=dragtouch.js.map
