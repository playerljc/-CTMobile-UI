"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),selectorPrefix="ct-drag-";function initEvents(){var s=this;initDragSourceEvent.call(s);var e=s.config,t=e.isDragSourceDisplay,r=void 0===t||t,l=e.isDragSourceExist,i=void 0===l||l;s.el.addEventListener("mousemove",function(e){if(!s.isdown)return!1;s.ismove||(s.ismove=!0,r&&i||(s.sourceEl.style.visibility="hidden"));var t=e.clientX,l=e.clientY;console.log(t,l),0<getMoveInTargetEls.call(s).complete.length?s.cloneEl.style.cursor="pointer":s.cloneEl.style.cursor="not-allowed";var o=t-s.firstX,n=l-s.firstY;s.cloneEl.style.left="".concat(s.baseX+o,"px"),s.cloneEl.style.top="".concat(s.baseY+n,"px")}),s.el.addEventListener("mouseleave",function(){if(!s.isdown)return!1;reset.call(s)})}function initDragSourceEvent(){var i=this,c=this,e=c.config,t=e.dragSourceExtendClasses,a=void 0===t?[]:t,u=e.onDragClone,f=e.onPutSuccess,d=e.onSourceEnter,v=e.onSourceLeave,l=e.isDragSourceExist,E=void 0===l||l;c.sourceEventHanlder=new WeakMap;for(var o=function(e){var o=i.sourceEls[e],t={};function l(){var e=o.cloneNode(!0);return a?e.className+=" ".concat(a.join(" ")):e.style.border="1px dashed black",e}function n(e){c.isdown=!0;var t=(c.sourceEl=o).getBoundingClientRect();c.baseX=t.left,c.baseY=t.top,c.firstX=e.clientX,c.firstY=e.clientY,u?(c.cloneEl=u(o),c.cloneEl||(c.cloneEl=l())):c.cloneEl=l(),c.cloneEl.setAttribute("id",""),c.cloneEl.style.minWidth="".concat(o.offsetWidth,"px"),c.cloneEl.style.minHeight="".concat(o.offsetHeight,"px"),c.cloneEl.style.position="fixed",c.cloneEl.style.zIndex="9999",c.cloneEl.style.left="".concat(c.baseX,"px"),c.cloneEl.style.top="".concat(c.baseY,"px"),c.cloneEl.style.margin="0",c.cloneEl.addEventListener("mouseup",function(){if(!c.ismove)return reset.call(c),!1;var e=getMoveInTargetEls.call(c);if(0<e.complete.length){if(f){var t=c.cloneEl.getBoundingClientRect(),l=o.cloneNode(!0);l.style.visibility="visible",l.style.cursor="default",f({cloneSourceEl:l,sourceEl:o,targetEls:e.complete,rect:{left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width,height:t.height,x:t.x,y:t.y}})?(E||c.sourceEl&&(c.sourceEl.parentElement.removeChild(c.sourceEl),c.sourceEl=null),reset.call(c,e.complete)):goBack.call(c,o,e.complete)}}else goBack.call(c,o,e.section)}),c.el.appendChild(c.cloneEl)}function s(){o.style.cursor="move",d&&d(o)}function r(){o.style.cursor="default",v&&v(o)}o.addEventListener("mousedown",t.mousedown=n),o.addEventListener("mouseenter",t.mouseenter=s),o.addEventListener("mouseleave",t.mouseover=r),c.sourceEventHanlder.set(o,t)},n=0;n<this.sourceEls.length;n++)o(n)}function getMoveInTargetEls(){for(var o=this,n=[],s=[],r=this.cloneEl.getBoundingClientRect(),e=this.config.dragTargetExtendClasses,i=void 0===e?[]:e,t=function(e){var t=o.targetEls[e],l=t.getBoundingClientRect();(r.left>=l.left&&r.left<=l.right||r.right>=l.left&&r.right<=l.right)&&(r.top>=l.top&&r.top<=l.bottom||r.bottom>=l.top&&r.bottom<=l.bottom)?(i?(i.map(function(e){e&&t.classList.remove(e)}),t.className+=" ".concat(i.join(" "))):t.style.border="2px dashed black",r.left>=l.left&&r.left<=l.right&&r.right>=l.left&&r.right<=l.right&&r.top>=l.top&&r.top<=l.bottom&&r.bottom>=l.top&&r.bottom<=l.bottom?n.push(t):s.push(t)):i?i.map(function(e){e&&t.classList.remove(e)}):t.style.border="0"},l=0;l<this.targetEls.length;l++)t(l);return{complete:n,section:s}}function goBack(t,l){var o=this,e=this.config.noDragReturnAnimate;void 0!==e&&e?setTimeout(function(){o.isdown=!1,o.cloneEl.addEventListener("transitionend",function e(){o.cloneEl.removeEventListener("transitionend",e),reset.call(o,l),t.style.visibility="visible"}),o.cloneEl.style.transition="all .25s ease-out",o.cloneEl.style.transform="translateZ(0)";var e=t.getBoundingClientRect();o.cloneEl.style.left="".concat(e.left,"px"),o.cloneEl.style.top="".concat(e.top,"px")},100):(reset.call(o,l),t.style.visibility="visible")}function reset(l){var e=this,t=this.config.dragTargetExtendClasses,o=void 0===t?[]:t;if(e.cloneEl&&e.el.removeChild(e.cloneEl),l&&0<l.length)for(var n=function(t){o?o.map(function(e){e&&l[t].classList.remove(e)}):l[t].style.border="0"},s=0;s<l.length;s++)n(s);e.isdown=!1,e.ismove=!1,e.baseX=null,e.baseY=null,e.firstX=null,e.firstY=null,e.cloneEl=null,e.sourceEl=null}var Drag=function(){function l(e,t){(0,_classCallCheck2.default)(this,l),this.el=e,this.config=Object.assign({},t),this.sourceEls=this.el.querySelectorAll(".".concat(selectorPrefix,"source")),this.targetEls=this.el.querySelectorAll(".".concat(selectorPrefix,"target")),this.isdown=!1,this.ismove=!1,this.baseX=null,this.baseY=null,this.firstX=null,this.firstY=null,this.cloneEl=null,this.sourceEl=null,initEvents.call(this)}return(0,_createClass2.default)(l,[{key:"refresh",value:function(){for(var e=0;e<this.sourceEls.length;e++){var t=this.sourceEls[e],l=this.sourceEventHanlder.get(t);for(var o in l)t.removeEventListener(o,l[o])}this.sourceEls=document.querySelectorAll(".".concat(selectorPrefix,"source")),this.targetEls=this.el.querySelectorAll(".".concat(selectorPrefix,"target")),initDragSourceEvent.call(this)}}]),l}(),DragFactory={create:function(e,t){return new Drag(e,t)}},_default=DragFactory;exports.default=_default;
//# sourceMappingURL=drag.js.map
