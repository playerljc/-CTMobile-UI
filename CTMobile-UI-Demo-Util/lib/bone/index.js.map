{"version":3,"sources":["bone/index.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","_classCallCheck2","_createClass2","_swiper","_uiUtil","initEvents","this","swiper","on","onSlideChange","onSlideChangeTransitionStart","LinkCapture","target","tagName","toLocaleLowerCase","Dom6","getParentElementByTag","doneKey","dataset","donekey","index","findIndexByKey","slideTo","history","push","console","log","BackCapture","className","indexOf","length","pop","CaptureElement","chain","self","el","firstElementChild","addEventListener","e","preventDefault","i","call","Bone","classed","arguments","undefined","Map","slideInstances","onInit","bind","allowTouchMove","init","key","_this","forEach","slideInstance","context","getElByKey","set","preIndex","activeIndex","findKeyByIndex","get","onShow","children","$wrapperEl","querySelector","concat","_default"],"mappings":"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","file":"index.js","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _swiper = _interopRequireDefault(require(\"swiper\"));\n\nvar _uiUtil = require(\"@ctmobile/ui-util\");\n\n/**\r\n * initEvents\r\n * @access private\r\n */\nfunction initEvents() {\n  this.swiper.on('slideChange', this.onSlideChange);\n  this.swiper.on('slideChangeTransitionStart', this.onSlideChangeTransitionStart);\n}\n/**\r\n * LinkCapture\r\n * @param {HtmlElement} - target\r\n * @return {boolean}\r\n */\n\n\nfunction LinkCapture(target) {\n  // 不是a元素\n  if (target.tagName.toLocaleLowerCase() !== 'a' && !(target = _uiUtil.Dom6.getParentElementByTag(target, 'a'))) {\n    return false;\n  }\n\n  var doneKey = target.dataset.donekey;\n  if (!doneKey) return false;\n  var index = this.findIndexByKey(doneKey);\n  if (index === -1) return false;\n  this.swiper.slideTo(index);\n  this.history.push(index);\n  console.log('historyStart', this.history);\n  return true;\n}\n/**\r\n * BackCapture\r\n * @param {HtmlElement} - target\r\n * @return {boolean}\r\n */\n\n\nfunction BackCapture(target) {\n  if (target.className.indexOf('ctmobile-ui-demo-done-page-header-backicon') === -1) {\n    return false;\n  }\n\n  if (this.history.length <= 1) return false;\n  var index = this.history.length - 2;\n  console.log('backIndex:', index);\n  this.swiper.slideTo(index);\n  this.history.pop();\n  console.log('historyEnd', this.history);\n  return true;\n}\n/**\r\n * CaptureElement\r\n * @access private\r\n */\n\n\nvar CaptureElement = function () {\n  var chain = [LinkCapture, BackCapture];\n  return function () {\n    var self = this;\n    this.el.firstElementChild.addEventListener('click', function (e) {\n      e.preventDefault();\n      var target = e.target;\n      if (!target) return false;\n\n      for (var i = 0; i < chain.length; i++) {\n        var CaptureTarget = chain[i];\n        var flag = CaptureTarget.call(self, target);\n        if (flag) break;\n      }\n    });\n  };\n}();\n/**\r\n * Bone\r\n * @class Bone\r\n * @classdesc bone\r\n */\n\n\nvar Bone =\n/*#__PURE__*/\nfunction () {\n  /**\r\n   * constructor\r\n   * @constructor\r\n   * @param {HtmlElement} el\r\n   * @param {Array} classed\r\n   */\n  function Bone(el) {\n    var classed = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    (0, _classCallCheck2.default)(this, Bone);\n    this.el = el;\n    this.classed = new Map(classed);\n    this.slideInstances = new Map();\n    this.history = [];\n    CaptureElement.call(this);\n    this.onInit = this.onInit.bind(this);\n    this.onSlideChange = this.onSlideChange.bind(this);\n    this.onSlideChangeTransitionStart = this.onSlideChangeTransitionStart.bind(this);\n    this.swiper = new _swiper.default(this.el, {\n      // 如果为false，则切换幻灯片的唯一方法是使用外部API函数，如slidePrev或slideNext\n      allowTouchMove: false,\n      on: {\n        init: this.onInit()\n      }\n    });\n    initEvents.call(this);\n  }\n  /**\r\n   * onInit\r\n   */\n\n\n  (0, _createClass2.default)(Bone, [{\n    key: \"onInit\",\n    value: function onInit() {\n      var _this = this;\n\n      this.classed.forEach(function (value, key) {\n        if (!value) return false;\n        var slideInstance = new value({\n          context: _this,\n          key: key,\n          el: _this.getElByKey(key)\n        });\n\n        if (slideInstance.onInit) {\n          slideInstance.onInit();\n        }\n\n        _this.slideInstances.set(key, slideInstance);\n      }); // 调用第一页的onShow\n\n      this.onSlideChange();\n      this.history.push(0);\n    }\n    /**\r\n     * onSlideChangeTransitionStart\r\n     */\n\n  }, {\n    key: \"onSlideChangeTransitionStart\",\n    value: function onSlideChangeTransitionStart() {\n      this.preIndex = this.swiper.activeIndex;\n    }\n    /**\r\n     * onSlideChange\r\n     */\n\n  }, {\n    key: \"onSlideChange\",\n    value: function onSlideChange() {\n      var activeIndex = this.swiper ? this.swiper.activeIndex : 0;\n      var key = this.findKeyByIndex(activeIndex);\n      var slideInstance = this.slideInstances.get(key);\n\n      if (slideInstance && slideInstance.onShow) {\n        slideInstance.onShow();\n      }\n    }\n    /**\r\n     * 通过索引寻找key\r\n     * @param {number} - index\r\n     * @return {string} - key\r\n     */\n\n  }, {\n    key: \"findKeyByIndex\",\n    value: function findKeyByIndex() {\n      var index = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      var el = this.el.firstElementChild.children[index];\n\n      if (el) {\n        return el.dataset.key;\n      }\n    }\n    /**\r\n     * findIndexByKey\r\n     * @param {string} - key\r\n     * @return {number} - index\r\n     */\n\n  }, {\n    key: \"findIndexByKey\",\n    value: function findIndexByKey(key) {\n      var el = this.getElByKey(key);\n      if (!el) return -1;\n      var index = -1;\n      var children = this.swiper.$wrapperEl.children();\n\n      for (var i = 0; i < children.length; i++) {\n        if (children[i] === el) {\n          index = i;\n          break;\n        }\n      }\n\n      return index;\n    }\n    /**\r\n     * getElByKey\r\n     * @param {string} - key\r\n     * @return - {HtmlElement}\r\n     */\n\n  }, {\n    key: \"getElByKey\",\n    value: function getElByKey(key) {\n      return this.el.firstElementChild.querySelector(\"[data-key=\\\"\".concat(key, \"\\\"]\"));\n    }\n  }]);\n  return Bone;\n}();\n\nvar _default = Bone;\nexports.default = _default;"]}