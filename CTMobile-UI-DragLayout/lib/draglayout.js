"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=_default;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),STATUS_NOSWIPE="noswipe",STATUS_SWIPE="swipe",SWIPE_FAST_DISTANCE=1200,SWIPE_VERTICAL_DISTANCE=30,SWIPE_DURATION="300";function clearTouchEventListener(){this.masterDom.removeEventListener("touchmove",onTouchmoveAction),this.masterDom.removeEventListener("touchend",onTouchendAction)}function noSwipe(t){var e=this;setTransform(e.masterDom,"scale(1,1) translate3d(0,0,0)"),setTransform(e.slaveDom,"scale(0,0)"),setOpacity(e.slaveDom,"0"),t&&t()}function swipeEnd(t){var e=this;setTransform(e.masterDom,"scale(1,".concat(e.masterScaleMixVal.scaleY,") translate3d(").concat(e.swipeWidth,"px,0,0)")),setTransform(e.slaveDom,"scale(1,1)"),setOpacity(e.slaveDom,"1"),t&&t()}function swipe(t){var e=this,a=null,s=null,n=null;setTransformOrigin(e.masterDom,"right center"),setTransformOrigin(e.slaveDom,"left center"),e.masterDom.dataset.status===STATUS_NOSWIPE?(a=Math.abs(t),s=1-Math.abs(t)/e.masterHeight,n=Math.abs(t)/e.swipeWidth):e.masterDom.dataset.status===STATUS_SWIPE&&(a=e.swipeWidth+t,s=e.masterScaleMixVal.scaleY+Math.abs(t)/e.masterHeight,n=1-Math.abs(t)/e.swipeWidth),setTransform(e.masterDom,"scale(1,".concat(s,") translate3d(").concat(a,"px,0,0)")),setTransform(e.slaveDom,"scale(".concat(n,")")),setOpacity(e.slaveDom,n)}function setTransitionByMasterAndSlave(t,e){var a="transform ".concat(t).concat(e," linear,opacity ").concat(t).concat(e," linear");setTransition(this.masterDom,a),setTransition(this.slaveDom,a)}function getMasterScaleMinValue(){var t=this;return{scaleX:1-t.swipeWidth/t.masterWidth,scaleY:1-t.swipeWidth/t.masterHeight}}function setTransform(t,e){t.style.webkitTransform=t.style.MozTransform=t.style.msTransform=t.style.OTransform=t.style.transform=e}function setTransition(t,e){t.style.webkitTransition=t.style.MozTransition=t.style.msTransition=t.style.OTransition=t.style.transition=e}function setTransformOrigin(t,e){t.style.webkitTransformOrigin=t.style.MozTransformOrigin=t.style.msTransformOrigin=t.style.OTransformOrigin=t.style.transformOrigin=e}function setOpacity(t,e){t.style.webkitOpacity=t.style.MozOpacity=t.style.msOpacity=t.style.OOpacity=t.style.opacity=e}function onTouchstartAction(t){var e=this;e.startTime=+new Date,e.endTime=0,e.startX=t.changedTouches?t.changedTouches[0].pageX:t.pageX,e.startY=t.changedTouches?t.changedTouches[0].pageY:t.pageY,e.endX=0,e.endY=0,e.isMove=!1,e.scroll=!1,setTransitionByMasterAndSlave.call(e,"0","ms"),e.masterDom.addEventListener("touchmove",onTouchmoveAction),e.masterDom.addEventListener("mousemove",onTouchmoveAction),e.masterDom.addEventListener("touchend",onTouchendAction),e.masterDom.addEventListener("mouseup",onTouchendAction)}function onTouchmoveAction(t){var e=this;e.endX=t.changedTouches?t.changedTouches[0].pageX:t.pageX,e.endY=t.changedTouches?t.changedTouches[0].pageY:t.pageY;var a=Math.abs(parseInt(e.endY)-parseInt(e.startY)),s=Math.abs(parseInt(e.endX)-parseInt(e.startX));if(SWIPE_VERTICAL_DISTANCE<a&&s<SWIPE_VERTICAL_DISTANCE)return e.isMove=!1,void(e.scroll=!0);e.isMove=!0;var n=parseInt(e.endX)-parseInt(e.startX);e.masterDom.dataset.status===STATUS_NOSWIPE?n<=0?noSwipe.call(e):Math.abs(n)<=e.swipeWidth?swipe.call(e,n):swipeEnd.call(e):e.masterDom.dataset.status===STATUS_SWIPE&&(0<=n?swipeEnd.call(e):Math.abs(n)<=e.swipeWidth?swipe.call(e,n):noSwipe.call(e))}function onTouchendAction(t){var e=this;if(!e.isMove)return e.masterDom.removeEventListener("touchmove",onTouchmoveAction),e.masterDom.removeEventListener("mousemove",onTouchmoveAction),e.masterDom.removeEventListener("touchend",onTouchendAction),e.masterDom.removeEventListener("mouseup",onTouchendAction),void(e.masterDom.dataset.status===STATUS_SWIPE?swipeEnd.call(e):e.masterDom.dataset.status===STATUS_NOSWIPE&&noSwipe.call(e));e.endX=t.changedTouches?t.changedTouches[0].pageX:t.pageX,e.endTime=+new Date;var a=parseInt(e.endX)-parseInt(e.startX);setTransitionByMasterAndSlave.call(e,SWIPE_DURATION,"ms"),e.masterDom.dataset.status===STATUS_NOSWIPE?a<=0?noSwipe.call(e):Math.abs(a)<=e.swipeWidth?Number(e.endTime)-Number(e.startTime)<=SWIPE_FAST_DISTANCE?swipeEnd.call(e,function(){e.masterDom.dataset.status=STATUS_SWIPE,e.config.showCallback&&e.config.showCallback()}):Math.abs(a)>=e.swipeWidth/2?swipeEnd.call(e,function(){e.masterDom.dataset.status=STATUS_SWIPE,e.config.showCallback&&e.config.showCallback()}):noSwipe.call(e):swipeEnd.call(e,function(){e.masterDom.dataset.status=STATUS_SWIPE,e.config.showCallback&&e.config.showCallback()}):e.masterDom.dataset.status===STATUS_SWIPE&&(0<=a?swipeEnd.call(e):Math.abs(a)<=e.swipeWidth?Number(e.endTime)-Number(e.startTime)<=SWIPE_FAST_DISTANCE?noSwipe.call(e,function(){e.masterDom.dataset.status=STATUS_NOSWIPE,e.config.hideCallback&&e.config.hideCallback()}):Math.abs(a)>=e.swipeWidth/2?noSwipe.call(e,function(){e.masterDom.dataset.status=STATUS_NOSWIPE,e.config.hideCallback&&e.config.hideCallback()}):swipeEnd.call(e):noSwipe.call(e,function(){e.masterDom.dataset.status=STATUS_NOSWIPE,e.config.hideCallback&&e.config.hideCallback()})),clearTouchEventListener.call(e)}var DragLayout=function(){function a(t,e){(0,_classCallCheck2.default)(this,a),this.el=t,this.config=Object.assign({},e),this.slaveDom=this.el.querySelector(".ct-draglayout-slave"),this.masterDom=this.el.querySelector(".ct-draglayout-master"),this.swipeWidth=this.slaveDom.clientWidth,this.masterWidth=this.masterDom.clientWidth,this.masterHeight=this.masterDom.clientHeight,this.masterScaleMixVal=getMasterScaleMinValue.call(this),this.masterDom.dataset.status||(this.masterDom.dataset.status=STATUS_NOSWIPE),onTouchstartAction=onTouchstartAction.bind(this),onTouchmoveAction=onTouchmoveAction.bind(this),onTouchendAction=onTouchendAction.bind(this),this.masterDom.addEventListener("touchstart",onTouchstartAction),this.masterDom.addEventListener("mousedown",onTouchstartAction)}return(0,_createClass2.default)(a,[{key:"show",value:function(){var t=this;setTransitionByMasterAndSlave.call(t,SWIPE_DURATION,"ms"),swipeEnd.call(t,function(){t.masterDom.dataset.status=STATUS_SWIPE})}},{key:"hide",value:function(){var t=this;setTransitionByMasterAndSlave.call(t,SWIPE_DURATION,"ms"),noSwipe.call(t,function(){t.masterDom.dataset.status=STATUS_NOSWIPE})}},{key:"isShow",value:function(){return this.masterDom.dataset.status!==STATUS_NOSWIPE}}]),a}();function _default(t,e){return new DragLayout(t,e)}