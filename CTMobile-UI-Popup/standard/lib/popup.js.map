{"version":3,"sources":["popup.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","prePopup","maskEl","_classCallCheck2","_createClass2","_uiUtil","el","document","body","bindEvents","this","onInnerElTransitionend","bind","onMaskElTransitionend","initEvents","config","listeners","_this$config$listener","keys","i","length","p","events","on","innerEl","addEventListener","LinkCaptureShow","target","tagName","toLocaleLowerCase","Dom6","getParentElementByTag","popupId","dataset","popup","getId","PopupFactory","show","create","getElementById","LinkCaptureClose","closeAll","CaptureElement","chain","e","preventDefault","CaptureTarget","createMask","createElement","appendChild","Popup","tel","arguments","undefined","isShow","id","Events","content","querySelector","cloneNode","call","trigger","key","_this","close","style","display","setTimeout","classList","add","remove","parentNode","removeChild","type","handler","clear","clearAll","isDistory","distory","getEl","setEl","_default"],"mappings":"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","file":"popup.js","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _uiUtil = require(\"@ctmobile/ui-util\");\n\nvar prePopup;\nvar maskEl;\nvar el = document.body;\n/**\r\n * bindEvents\r\n * @access private\r\n */\n\nfunction bindEvents() {\n  this.onInnerElTransitionend = this.onInnerElTransitionend.bind(this);\n  this.onMaskElTransitionend = this.onMaskElTransitionend.bind(this);\n}\n/**\r\n * initEvents\r\n * @access private\r\n */\n\n\nfunction initEvents() {\n  if (this.config && this.config.listeners) {\n    var _this$config$listener = this.config.listeners,\n        listeners = _this$config$listener === void 0 ? {} : _this$config$listener;\n    var keys = Object.keys(listeners);\n\n    for (var i = 0; i < keys.length; i += 1) {\n      var p = keys[i];\n      this.events.on(p, listeners[p]);\n    }\n  }\n\n  this.innerEl.addEventListener('transitionend', this.onInnerElTransitionend);\n}\n/**\r\n * LinkCaptureShow\r\n * @param {HtmlElement} - target\r\n * @access private\r\n * @return {boolean}\r\n */\n\n\nfunction LinkCaptureShow(target) {\n  // 不是a元素\n  if (target.tagName.toLocaleLowerCase() !== 'a' && !(target = _uiUtil.Dom6.getParentElementByTag(target, 'a'))) {\n    return false;\n  }\n\n  var popupId = target.dataset.popup;\n  if (!popupId) return false;\n\n  if (!prePopup || prePopup && prePopup.getId() !== popupId) {\n    PopupFactory.show(PopupFactory.create(document.getElementById(popupId)));\n  } else {\n    return false;\n  }\n\n  return true;\n}\n/**\r\n * LinkCaptureClose\r\n * @param {HtmlElement} - target\r\n * @access private\r\n * @return {boolean}\r\n */\n\n\nfunction LinkCaptureClose(target) {\n  // 不是a元素\n  if (target.tagName.toLocaleLowerCase() !== 'a' && !(target = _uiUtil.Dom6.getParentElementByTag(target, 'a'))) {\n    return false;\n  }\n\n  if (!('close' in target.dataset)) return false;\n  PopupFactory.closeAll();\n  return true;\n}\n/**\r\n * CaptureElement\r\n * @access private\r\n */\n\n\nvar CaptureElement = function () {\n  var chain = [LinkCaptureShow, LinkCaptureClose];\n  return function () {\n    document.body.addEventListener('click', function (e) {\n      e.preventDefault();\n      var target = e.target;\n      if (!target) return false;\n\n      for (var i = 0; i < chain.length; i++) {\n        var CaptureTarget = chain[i];\n        var flag = CaptureTarget(target);\n        if (flag) break;\n      }\n    });\n  };\n}();\n/**\r\n * createMask\r\n * @access private\r\n */\n\n\nfunction createMask() {\n  maskEl = _uiUtil.Dom6.createElement('<div class=\"ct-popup-mask\"></div>');\n  el.appendChild(maskEl);\n  maskEl.addEventListener('transitionend', this.onMaskElTransitionend);\n}\n/**\r\n * Popup\r\n * @class Popup\r\n * @classdesc Popup\r\n */\n\n\nvar Popup =\n/*#__PURE__*/\nfunction () {\n  /**\r\n   * constructor\r\n   * @param {HtmlElement} - tel <template>的el\r\n   * @param config {Object} - config\r\n   */\n  function Popup(tel) {\n    var config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    (0, _classCallCheck2.default)(this, Popup);\n    this.isShow = false;\n    this.tel = tel;\n    this.el = el;\n    this.id = this.tel.id;\n    this.config = config;\n    this.events = new _uiUtil.Events();\n    this.innerEl = this.tel.content.querySelector('.ct-popup').cloneNode(true);\n    bindEvents.call(this);\n    initEvents.call(this);\n    this.el.appendChild(this.innerEl);\n    this.events.trigger('create', this.innerEl);\n\n    _uiUtil.Events.trigger('ct-popup-event-create', this, this.innerEl);\n  }\n  /**\r\n   * 显示一个popup\r\n   */\n\n\n  (0, _createClass2.default)(Popup, [{\n    key: \"show\",\n    value: function show() {\n      var _this = this;\n\n      if (!maskEl) {\n        createMask.call(this);\n      }\n\n      if (prePopup) {\n        prePopup.close();\n      }\n\n      maskEl.style.display = 'block';\n      this.innerEl.style.display = 'block';\n      this.isShow = true;\n      this.events.trigger('beforeshow');\n\n      _uiUtil.Events.trigger('ct-popup-event-beforeshow', this);\n\n      setTimeout(function () {\n        maskEl.classList.add('modal-in');\n\n        _this.innerEl.classList.add('modal-in');\n      }, 100);\n    }\n    /**\r\n     * 关闭一个popup\r\n     */\n\n  }, {\n    key: \"close\",\n    value: function close() {\n      if (!maskEl) {\n        createMask.call(this);\n      }\n\n      this.isShow = false;\n      this.events.trigger('beforeclose');\n\n      _uiUtil.Events.trigger('ct-popup-event-beforeclose', this);\n\n      this.innerEl.classList.remove('modal-in');\n      maskEl.classList.remove('modal-in');\n    }\n    /**\r\n     * 销毁一个popup\r\n     */\n\n  }, {\n    key: \"distory\",\n    value: function distory() {\n      this.innerEl.parentNode.removeChild(this.innerEl);\n      this.innerEl = null;\n      this.events.trigger('distory');\n\n      _uiUtil.Events.trigger('ct-popup-event-distory', this);\n    }\n    /**\r\n     * onInnerElTransitionend\r\n     */\n\n  }, {\n    key: \"onInnerElTransitionend\",\n    value: function onInnerElTransitionend() {\n      if (!this.isShow) {\n        prePopup = null;\n        this.innerEl.style.display = 'none';\n        this.events.trigger('afterclose');\n\n        _uiUtil.Events.trigger('ct-popup-event-afterclose', this);\n      } else {\n        prePopup = this;\n        this.events.trigger('aftershow');\n\n        _uiUtil.Events.trigger('ct-popup-event-aftershow', this);\n      }\n    }\n    /**\r\n     * onMaskElTransitionend\r\n     */\n\n  }, {\n    key: \"onMaskElTransitionend\",\n    value: function onMaskElTransitionend() {\n      if (!this.isShow) {\n        maskEl.style.display = 'none';\n      }\n    }\n    /**\r\n     * 是否已经销毁\r\n     * @return {boolean}\r\n     */\n\n  }, {\n    key: \"isDistory\",\n    value: function isDistory() {\n      return !this.innerEl;\n    }\n    /**\r\n     * on 注册事件\r\n     * @param {string} type\r\n     * @param {Function} handler\r\n     */\n\n  }, {\n    key: \"on\",\n    value: function on(type, handler) {\n      this.events.on(type, handler);\n    }\n    /**\r\n     * 删除指定type下的事件或清除所有\r\n     * @param {string} type\r\n     * @param {Function} handler\r\n     */\n\n  }, {\n    key: \"off\",\n    value: function off(type, handler) {\n      if (type) {\n        if (handler) {\n          this.events.remove(type, handler);\n        } else {\n          this.events.clear(type);\n        }\n      } else {\n        this.events.clearAll();\n      }\n    }\n    /**\r\n     * getId\r\n     * @return {string} - id\r\n     */\n\n  }, {\n    key: \"getId\",\n    value: function getId() {\n      return this.id;\n    }\n  }]);\n  return Popup;\n}();\n/**\r\n * PopupFactory\r\n */\n\n\nvar PopupFactory = {\n  /**\r\n   * 创建一个Popup\r\n   * @param {HtmlElement} - tel <template>元素\r\n   * @param {Object} - config\r\n   * @return {Popup} - Popup\r\n   */\n  create: function create(tel, config) {\n    return new Popup(tel, config);\n  },\n\n  /**\r\n   * 显示一个popup\r\n   * @param {Popup} popup\r\n   */\n  show: function show(popup) {\n    if (!popup) return false;\n    if (popup.isDistory()) return false;\n    if (popup === prePopup) return false;\n    if (prePopup && popup.getId() === prePopup.getId()) return false;\n    popup.show();\n  },\n\n  /**\r\n   * 关闭一个popup\r\n   * @param {Popup} popup\r\n   */\n  close: function close(popup) {\n    if (!popup) return false;\n    if (popup.isDistory()) return false;\n    popup.close();\n  },\n\n  /**\r\n   * 关闭所有\r\n   */\n  closeAll: function closeAll() {\n    if (prePopup) {\n      this.close(prePopup);\n    }\n  },\n\n  /**\r\n   * 销毁一个popup\r\n   * @param {Popup} popup\r\n   */\n  distory: function distory(popup) {\n    if (!popup) return false;\n    if (popup.isDistory()) return false;\n    popup.distory();\n  },\n\n  /**\r\n   * getEl\r\n   * @return {HTMLElement}\r\n   */\n  getEl: function getEl() {\n    return el;\n  },\n\n  /**\r\n   * setEl\r\n   * @param {HtmlElement} - el\r\n   */\n  setEl: function setEl(tel) {\n    el = tel;\n  }\n};\nCaptureElement();\n/**\r\n * Factory\r\n */\n\nvar _default = PopupFactory;\nexports.default = _default;"]}