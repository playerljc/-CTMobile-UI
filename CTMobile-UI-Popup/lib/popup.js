"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var prePopup,maskEl,_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_uiUtil=require("@ctmobile/ui-util");function bindEvents(){this.onInnerElTransitionend=this.onInnerElTransitionend.bind(this),this.onMaskElTransitionend=this.onMaskElTransitionend.bind(this)}function initEvents(){this.innerEl.addEventListener("transitionend",this.onInnerElTransitionend)}function LinkCaptureShow(e){if("a"!==e.tagName.toLocaleLowerCase()&&!(e=_uiUtil.Dom6.getParentElementByTag(e,"a")))return!1;var t=e.dataset.popup;return!!t&&(!(prePopup&&(!prePopup||prePopup.getId()===t))&&(PopupFactory.show(PopupFactory.create(document.getElementById(t))),!0))}function LinkCaptureClose(e){return!("a"!==e.tagName.toLocaleLowerCase()&&!(e=_uiUtil.Dom6.getParentElementByTag(e,"a")))&&("close"in e.dataset&&(PopupFactory.closeAll(),!0))}var CaptureElement=function(){var s=[LinkCaptureShow,LinkCaptureClose];return function(){var n=this;this.innerEl.addEventListener("click",function(e){e.preventDefault();var t=e.target;if(!t)return!1;for(var i=0;i<s.length;i++){if(s[i].call(n,t))break}})}}(),Popup=function(){function o(e){var t=e.tel,i=e.el,n=void 0===i?document.body:i,s=e.config,r=void 0===s?{}:s;(0,_classCallCheck2.default)(this,o),this.isShow=!1,this.tel=t,this.el=n,this.id=this.tel.id,this.config=r,this.events=new _uiUtil.Events,this.innerEl=this.tel.content.querySelector(".ct-popup").cloneNode(!0),bindEvents.call(this),initEvents.call(this),CaptureElement.call(this),this.el.appendChild(this.innerEl),this.events.trigger("create",this.innerEl),_uiUtil.Events.trigger("ct-popup-event-create",this,this.innerEl)}return(0,_createClass2.default)(o,[{key:"onInnerElTransitionend",value:function(){this.isShow?((prePopup=this).events.trigger("aftershow"),_uiUtil.Events.trigger("ct-popup-event-aftershow",this)):(prePopup=null,this.innerEl.style.display="none",this.events.trigger("afterclose"),_uiUtil.Events.trigger("ct-popup-event-afterclose",this))}},{key:"onMaskElTransitionend",value:function(){this.isShow||(maskEl.style.display="none")}},{key:"createMask",value:function(){maskEl=_uiUtil.Dom6.createElement('<div class="ct-popup-mask"></div>'),document.body.appendChild(maskEl),maskEl.addEventListener("transitionend",this.onMaskElTransitionend)}},{key:"show",value:function(){var e=this;maskEl||this.createMask(),prePopup&&prePopup.close(),maskEl.style.display="block",this.innerEl.style.display="block",this.isShow=!0,this.events.trigger("beforeshow"),_uiUtil.Events.trigger("ct-popup-event-beforeshow",this),setTimeout(function(){maskEl.classList.add("modal-in"),e.innerEl.classList.add("modal-in")},100)}},{key:"close",value:function(){maskEl||this.createMask(),this.isShow=!1,this.events.trigger("beforeclose"),_uiUtil.Events.trigger("ct-popup-event-beforeclose",this),this.innerEl.classList.remove("modal-in"),maskEl.classList.remove("modal-in")}},{key:"distory",value:function(){this.innerEl.parentNode.removeChild(this.innerEl),this.innerEl=null,this.events.trigger("distory"),_uiUtil.Events.trigger("ct-popup-event-distory",this)}},{key:"isDistory",value:function(){return!this.innerEl}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"off",value:function(e,t){e?t?this.events.remove(e,t):this.events.clear(e):this.events.clearAll()}},{key:"getId",value:function(){return this.id}}]),o}(),PopupFactory={create:function(e,t){return new Popup(e,t)},show:function(e){return!!e&&(!e.isDistory()&&(e!==prePopup&&((!prePopup||e.getId()!==prePopup.getId())&&void e.show())))},close:function(e){return!!e&&(!e.isDistory()&&void e.close())},closeAll:function(){prePopup&&this.close(prePopup)},distory:function(e){return!!e&&(!e.isDistory()&&void e.distory())}},_default=PopupFactory;exports.default=_default;
//# sourceMappingURL=popup.js.map
