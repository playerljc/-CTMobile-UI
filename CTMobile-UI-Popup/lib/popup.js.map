{"version":3,"sources":["popup.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","prePopup","maskEl","_classCallCheck2","_createClass2","_uiUtil","bindEvents","this","onInnerElTransitionend","bind","onMaskElTransitionend","initEvents","innerEl","addEventListener","LinkCaptureShow","target","tagName","toLocaleLowerCase","Dom6","getParentElementByTag","popupId","dataset","popup","getId","PopupFactory","show","create","document","getElementById","LinkCaptureClose","closeAll","CaptureElement","chain","self","e","preventDefault","i","length","call","Popup","_ref","tel","_ref$el","el","body","_ref$config","config","isShow","id","events","Events","content","querySelector","cloneNode","appendChild","trigger","key","style","display","createElement","_this","createMask","close","setTimeout","classList","add","remove","parentNode","removeChild","type","handler","on","clear","clearAll","isDistory","distory","_default"],"mappings":"AAAA,aAEA,IAAIA,uBAAyBC,QAAQ,gDAErCC,OAAOC,eAAeC,QAAS,aAAc,CAC3CC,OAAO,IAETD,QAAQE,aAAU,EAElB,IAMIC,SACAC,OAPAC,iBAAmBT,uBAAuBC,QAAQ,0CAElDS,cAAgBV,uBAAuBC,QAAQ,uCAE/CU,QAAUV,QAAQ,qBAStB,SAASW,aACPC,KAAKC,uBAAyBD,KAAKC,uBAAuBC,KAAKF,MAC/DA,KAAKG,sBAAwBH,KAAKG,sBAAsBD,KAAKF,MAQ/D,SAASI,aACPJ,KAAKK,QAAQC,iBAAiB,gBAAiBN,KAAKC,wBAUtD,SAASM,gBAAgBC,GAEvB,GAA2C,MAAvCA,EAAOC,QAAQC,uBAAiCF,EAASV,QAAQa,KAAKC,sBAAsBJ,EAAQ,MACtG,OAAO,EAGT,IAAIK,EAAUL,EAAOM,QAAQC,MAC7B,QAAKF,MAEAnB,YAAYA,UAAYA,SAASsB,UAAYH,MAChDI,aAAaC,KAAKD,aAAaE,OAAOC,SAASC,eAAeR,MAKzD,IAUT,SAASS,iBAAiBd,GAExB,QAA2C,MAAvCA,EAAOC,QAAQC,uBAAiCF,EAASV,QAAQa,KAAKC,sBAAsBJ,EAAQ,SAIlG,UAAWA,EAAOM,UACxBG,aAAaM,YACN,IAQT,IAAIC,eAAiB,WACnB,IAAIC,EAAQ,CAAClB,gBAAiBe,kBAC9B,OAAO,WACL,IAAII,EAAO1B,KACXA,KAAKK,QAAQC,iBAAiB,QAAS,SAAUqB,GAC/CA,EAAEC,iBACF,IAAIpB,EAASmB,EAAEnB,OACf,IAAKA,EAAQ,OAAO,EAEpB,IAAK,IAAIqB,EAAI,EAAGA,EAAIJ,EAAMK,OAAQD,IAAK,CAGrC,GAFoBJ,EAAMI,GACDE,KAAKL,EAAMlB,GAC1B,UAZG,GAwBjBwB,MAEJ,WAWE,SAASA,EAAMC,GACb,IAAIC,EAAMD,EAAKC,IACXC,EAAUF,EAAKG,GACfA,OAAiB,IAAZD,EAAqBf,SAASiB,KAAOF,EAC1CG,EAAcL,EAAKM,OACnBA,OAAyB,IAAhBD,EAAyB,GAAKA,GAC3C,EAAI1C,iBAAiBH,SAASO,KAAMgC,GACpChC,KAAKwC,QAAS,EACdxC,KAAKkC,IAAMA,EACXlC,KAAKoC,GAAKA,EACVpC,KAAKyC,GAAKzC,KAAKkC,IAAIO,GACnBzC,KAAKuC,OAASA,EACdvC,KAAK0C,OAAS,IAAI5C,QAAQ6C,OAC1B3C,KAAKK,QAAUL,KAAKkC,IAAIU,QAAQC,cAAc,aAAaC,WAAU,GACrE/C,WAAWgC,KAAK/B,MAChBI,WAAW2B,KAAK/B,MAChBwB,eAAeO,KAAK/B,MACpBA,KAAKoC,GAAGW,YAAY/C,KAAKK,SACzBL,KAAK0C,OAAOM,QAAQ,SAAUhD,KAAKK,SAEnCP,QAAQ6C,OAAOK,QAAQ,wBAAyBhD,KAAMA,KAAKK,SA8J7D,OAvJA,EAAIR,cAAcJ,SAASuC,EAAO,CAAC,CACjCiB,IAAK,yBACLzD,MAAO,WACAQ,KAAKwC,SAOR9C,SAAWM,MACN0C,OAAOM,QAAQ,aAEpBlD,QAAQ6C,OAAOK,QAAQ,2BAA4BhD,QATnDN,SAAW,KACXM,KAAKK,QAAQ6C,MAAMC,QAAU,OAC7BnD,KAAK0C,OAAOM,QAAQ,cAEpBlD,QAAQ6C,OAAOK,QAAQ,4BAA6BhD,SAYvD,CACDiD,IAAK,wBACLzD,MAAO,WACAQ,KAAKwC,SACR7C,OAAOuD,MAAMC,QAAU,UAO1B,CACDF,IAAK,aACLzD,MAAO,WACLG,OAASG,QAAQa,KAAKyC,cAAc,qCACpChC,SAASiB,KAAKU,YAAYpD,QAC1BA,OAAOW,iBAAiB,gBAAiBN,KAAKG,yBAM/C,CACD8C,IAAK,OACLzD,MAAO,WACL,IAAI6D,EAAQrD,KAEPL,QACHK,KAAKsD,aAGH5D,UACFA,SAAS6D,QAGX5D,OAAOuD,MAAMC,QAAU,QACvBnD,KAAKK,QAAQ6C,MAAMC,QAAU,QAC7BnD,KAAKwC,QAAS,EACdxC,KAAK0C,OAAOM,QAAQ,cAEpBlD,QAAQ6C,OAAOK,QAAQ,4BAA6BhD,MAEpDwD,WAAW,WACT7D,OAAO8D,UAAUC,IAAI,YAErBL,EAAMhD,QAAQoD,UAAUC,IAAI,aAC3B,OAMJ,CACDT,IAAK,QACLzD,MAAO,WACAG,QACHK,KAAKsD,aAGPtD,KAAKwC,QAAS,EACdxC,KAAK0C,OAAOM,QAAQ,eAEpBlD,QAAQ6C,OAAOK,QAAQ,6BAA8BhD,MAErDA,KAAKK,QAAQoD,UAAUE,OAAO,YAC9BhE,OAAO8D,UAAUE,OAAO,cAMzB,CACDV,IAAK,UACLzD,MAAO,WACLQ,KAAKK,QAAQuD,WAAWC,YAAY7D,KAAKK,SACzCL,KAAKK,QAAU,KACfL,KAAK0C,OAAOM,QAAQ,WAEpBlD,QAAQ6C,OAAOK,QAAQ,yBAA0BhD,QAOlD,CACDiD,IAAK,YACLzD,MAAO,WACL,OAAQQ,KAAKK,UAQd,CACD4C,IAAK,KACLzD,MAAO,SAAYsE,EAAMC,GACvB/D,KAAK0C,OAAOsB,GAAGF,EAAMC,KAQtB,CACDd,IAAK,MACLzD,MAAO,SAAasE,EAAMC,GACpBD,EACEC,EACF/D,KAAK0C,OAAOiB,OAAOG,EAAMC,GAEzB/D,KAAK0C,OAAOuB,MAAMH,GAGpB9D,KAAK0C,OAAOwB,aAQf,CACDjB,IAAK,QACLzD,MAAO,WACL,OAAOQ,KAAKyC,OAGTT,EA7LT,GAoMIf,aAAe,CAOjBE,OAAQ,SAAgBe,EAAKK,GAC3B,OAAO,IAAIP,MAAME,EAAKK,IAOxBrB,KAAM,SAAcH,GAClB,QAAKA,KACDA,EAAMoD,cACNpD,IAAUrB,aACVA,UAAYqB,EAAMC,UAAYtB,SAASsB,eAC3CD,EAAMG,WAORqC,MAAO,SAAexC,GACpB,QAAKA,KACDA,EAAMoD,kBACVpD,EAAMwC,UAMRhC,SAAU,WACJ7B,UACFM,KAAKuD,MAAM7D,WAQf0E,QAAS,SAAiBrD,GACxB,QAAKA,KACDA,EAAMoD,kBACVpD,EAAMqD,aAONC,SAAWpD,aACf1B,QAAQE,QAAU4E","file":"popup.js","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _uiUtil = require(\"@ctmobile/ui-util\");\n\nvar prePopup;\nvar maskEl;\n/**\r\n * bindEvents\r\n * @access private\r\n */\n\nfunction bindEvents() {\n  this.onInnerElTransitionend = this.onInnerElTransitionend.bind(this);\n  this.onMaskElTransitionend = this.onMaskElTransitionend.bind(this);\n}\n/**\r\n * initEvents\r\n * @access private\r\n */\n\n\nfunction initEvents() {\n  this.innerEl.addEventListener('transitionend', this.onInnerElTransitionend);\n}\n/**\r\n * LinkCaptureShow\r\n * @param {HtmlElement} - target\r\n * @access private\r\n * @return {boolean}\r\n */\n\n\nfunction LinkCaptureShow(target) {\n  // 不是a元素\n  if (target.tagName.toLocaleLowerCase() !== 'a' && !(target = _uiUtil.Dom6.getParentElementByTag(target, 'a'))) {\n    return false;\n  }\n\n  var popupId = target.dataset.popup;\n  if (!popupId) return false;\n\n  if (!prePopup || prePopup && prePopup.getId() !== popupId) {\n    PopupFactory.show(PopupFactory.create(document.getElementById(popupId)));\n  } else {\n    return false;\n  }\n\n  return true;\n}\n/**\r\n * LinkCaptureClose\r\n * @param {HtmlElement} - target\r\n * @access private\r\n * @return {boolean}\r\n */\n\n\nfunction LinkCaptureClose(target) {\n  // 不是a元素\n  if (target.tagName.toLocaleLowerCase() !== 'a' && !(target = _uiUtil.Dom6.getParentElementByTag(target, 'a'))) {\n    return false;\n  }\n\n  if (!('close' in target.dataset)) return false;\n  PopupFactory.closeAll();\n  return true;\n}\n/**\r\n * CaptureElement\r\n * @access private\r\n */\n\n\nvar CaptureElement = function () {\n  var chain = [LinkCaptureShow, LinkCaptureClose];\n  return function () {\n    var self = this;\n    this.innerEl.addEventListener('click', function (e) {\n      e.preventDefault();\n      var target = e.target;\n      if (!target) return false;\n\n      for (var i = 0; i < chain.length; i++) {\n        var CaptureTarget = chain[i];\n        var flag = CaptureTarget.call(self, target);\n        if (flag) break;\n      }\n    });\n  };\n}();\n/**\r\n * Popup\r\n * @class Popup\r\n * @classdesc Popup\r\n */\n\n\nvar Popup =\n/*#__PURE__*/\nfunction () {\n  /**\r\n   * constructor\r\n   * @param {HtmlElement} - tel <template>的el\r\n   * @param {Object} - config\r\n   * {\r\n   *   tel {HtmlElement}\r\n   *   el {HtmlElement}\r\n   *   config {Object}\r\n   * }\r\n   */\n  function Popup(_ref) {\n    var tel = _ref.tel,\n        _ref$el = _ref.el,\n        el = _ref$el === void 0 ? document.body : _ref$el,\n        _ref$config = _ref.config,\n        config = _ref$config === void 0 ? {} : _ref$config;\n    (0, _classCallCheck2.default)(this, Popup);\n    this.isShow = false;\n    this.tel = tel;\n    this.el = el;\n    this.id = this.tel.id;\n    this.config = config;\n    this.events = new _uiUtil.Events();\n    this.innerEl = this.tel.content.querySelector('.ct-popup').cloneNode(true);\n    bindEvents.call(this);\n    initEvents.call(this);\n    CaptureElement.call(this);\n    this.el.appendChild(this.innerEl);\n    this.events.trigger('create', this.innerEl);\n\n    _uiUtil.Events.trigger('ct-popup-event-create', this, this.innerEl);\n  }\n  /**\r\n   * onInnerElTransitionend\r\n   */\n\n\n  (0, _createClass2.default)(Popup, [{\n    key: \"onInnerElTransitionend\",\n    value: function onInnerElTransitionend() {\n      if (!this.isShow) {\n        prePopup = null;\n        this.innerEl.style.display = 'none';\n        this.events.trigger('afterclose');\n\n        _uiUtil.Events.trigger('ct-popup-event-afterclose', this);\n      } else {\n        prePopup = this;\n        this.events.trigger('aftershow');\n\n        _uiUtil.Events.trigger('ct-popup-event-aftershow', this);\n      }\n    }\n    /**\r\n     * onMaskElTransitionend\r\n     */\n\n  }, {\n    key: \"onMaskElTransitionend\",\n    value: function onMaskElTransitionend() {\n      if (!this.isShow) {\n        maskEl.style.display = 'none';\n      }\n    }\n    /**\r\n     * createMask\r\n     */\n\n  }, {\n    key: \"createMask\",\n    value: function createMask() {\n      maskEl = _uiUtil.Dom6.createElement('<div class=\"ct-popup-mask\"></div>');\n      document.body.appendChild(maskEl);\n      maskEl.addEventListener('transitionend', this.onMaskElTransitionend);\n    }\n    /**\r\n     * 显示一个popup\r\n     */\n\n  }, {\n    key: \"show\",\n    value: function show() {\n      var _this = this;\n\n      if (!maskEl) {\n        this.createMask();\n      }\n\n      if (prePopup) {\n        prePopup.close();\n      }\n\n      maskEl.style.display = 'block';\n      this.innerEl.style.display = 'block';\n      this.isShow = true;\n      this.events.trigger('beforeshow');\n\n      _uiUtil.Events.trigger('ct-popup-event-beforeshow', this);\n\n      setTimeout(function () {\n        maskEl.classList.add('modal-in');\n\n        _this.innerEl.classList.add('modal-in');\n      }, 100);\n    }\n    /**\r\n     * 关闭一个popup\r\n     */\n\n  }, {\n    key: \"close\",\n    value: function close() {\n      if (!maskEl) {\n        this.createMask();\n      }\n\n      this.isShow = false;\n      this.events.trigger('beforeclose');\n\n      _uiUtil.Events.trigger('ct-popup-event-beforeclose', this);\n\n      this.innerEl.classList.remove('modal-in');\n      maskEl.classList.remove('modal-in');\n    }\n    /**\r\n     * 销毁一个popup\r\n     */\n\n  }, {\n    key: \"distory\",\n    value: function distory() {\n      this.innerEl.parentNode.removeChild(this.innerEl);\n      this.innerEl = null;\n      this.events.trigger('distory');\n\n      _uiUtil.Events.trigger('ct-popup-event-distory', this);\n    }\n    /**\r\n     * 是否已经销毁\r\n     * @return {boolean}\r\n     */\n\n  }, {\n    key: \"isDistory\",\n    value: function isDistory() {\n      return !this.innerEl;\n    }\n    /**\r\n     * on 注册事件\r\n     * @param {string} type\r\n     * @param {Function} handler\r\n     */\n\n  }, {\n    key: \"on\",\n    value: function on(type, handler) {\n      this.events.on(type, handler);\n    }\n    /**\r\n     * 删除指定type下的事件或清除所有\r\n     * @param {string} type\r\n     * @param {Function} handler\r\n     */\n\n  }, {\n    key: \"off\",\n    value: function off(type, handler) {\n      if (type) {\n        if (handler) {\n          this.events.remove(type, handler);\n        } else {\n          this.events.clear(type);\n        }\n      } else {\n        this.events.clearAll();\n      }\n    }\n    /**\r\n     * getId\r\n     * @return {string} - id\r\n     */\n\n  }, {\n    key: \"getId\",\n    value: function getId() {\n      return this.id;\n    }\n  }]);\n  return Popup;\n}();\n/**\r\n * PopupFactory\r\n */\n\n\nvar PopupFactory = {\n  /**\r\n   * 创建一个Popup\r\n   * @param {HtmlElement} - tel <template>元素\r\n   * @param {Object} - config\r\n   * @return {Popup} - Popup\r\n   */\n  create: function create(tel, config) {\n    return new Popup(tel, config);\n  },\n\n  /**\r\n   * 显示一个popup\r\n   * @param {Popup} popup\r\n   */\n  show: function show(popup) {\n    if (!popup) return false;\n    if (popup.isDistory()) return false;\n    if (popup === prePopup) return false;\n    if (prePopup && popup.getId() === prePopup.getId()) return false;\n    popup.show();\n  },\n\n  /**\r\n   * 关闭一个popup\r\n   * @param {Popup} popup\r\n   */\n  close: function close(popup) {\n    if (!popup) return false;\n    if (popup.isDistory()) return false;\n    popup.close();\n  },\n\n  /**\r\n   * 关闭所有\r\n   */\n  closeAll: function closeAll() {\n    if (prePopup) {\n      this.close(prePopup);\n    }\n  },\n\n  /**\r\n   * 销毁一个popup\r\n   * @param {Popup} popup\r\n   */\n  distory: function distory(popup) {\n    if (!popup) return false;\n    if (popup.isDistory()) return false;\n    popup.distory();\n  }\n};\n/**\r\n * Factory\r\n */\n\nvar _default = PopupFactory;\nexports.default = _default;"]}