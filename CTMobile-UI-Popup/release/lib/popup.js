"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var prePopup,maskEl,_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_uiUtil=require("@ctmobile/ui-util"),el=document.body;function bindEvents(){this.onInnerElTransitionend=this.onInnerElTransitionend.bind(this),this.onMaskElTransitionend=this.onMaskElTransitionend.bind(this)}function initEvents(){if(this.config&&this.config.listeners)for(var e=this.config.listeners,t=void 0===e?{}:e,i=Object.keys(t),n=0;n<i.length;n+=1){var s=i[n];this.events.on(s,t[s])}this.innerEl.addEventListener("transitionend",this.onInnerElTransitionend)}function LinkCaptureShow(e){if("a"!==e.tagName.toLocaleLowerCase()&&!(e=_uiUtil.Dom6.getParentElementByTag(e,"a")))return!1;var t=e.dataset.popup;return!!t&&(!(prePopup&&(!prePopup||prePopup.getId()===t))&&(PopupFactory.show(PopupFactory.create(document.getElementById(t))),!0))}function LinkCaptureClose(e){return!("a"!==e.tagName.toLocaleLowerCase()&&!(e=_uiUtil.Dom6.getParentElementByTag(e,"a")))&&("close"in e.dataset&&(PopupFactory.closeAll(),!0))}var CaptureElement=function(){var n=[LinkCaptureShow,LinkCaptureClose];return function(){document.body.addEventListener("click",function(e){e.preventDefault();var t=e.target;if(!t)return!1;for(var i=0;i<n.length;i++){if((0,n[i])(t))break}})}}();function createMask(){maskEl=_uiUtil.Dom6.createElement('<div class="ct-popup-mask"></div>'),el.appendChild(maskEl),maskEl.addEventListener("transitionend",this.onMaskElTransitionend)}var Popup=function(){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(0,_classCallCheck2.default)(this,i),this.isShow=!1,this.tel=e,this.el=el,this.id=this.tel.id,this.config=t,this.events=new _uiUtil.Events,this.innerEl=this.tel.content.querySelector(".ct-popup").cloneNode(!0),bindEvents.call(this),initEvents.call(this),this.el.appendChild(this.innerEl),this.events.trigger("create",this.innerEl),_uiUtil.Events.trigger("ct-popup-event-create",this,this.innerEl)}return(0,_createClass2.default)(i,[{key:"show",value:function(){var e=this;maskEl||createMask.call(this),prePopup&&prePopup.close(),maskEl.style.display="block",this.innerEl.style.display="block",this.isShow=!0,this.events.trigger("beforeshow"),_uiUtil.Events.trigger("ct-popup-event-beforeshow",this),setTimeout(function(){maskEl.classList.add("modal-in"),e.innerEl.classList.add("modal-in")},100)}},{key:"close",value:function(){maskEl||createMask.call(this),this.isShow=!1,this.events.trigger("beforeclose"),_uiUtil.Events.trigger("ct-popup-event-beforeclose",this),this.innerEl.classList.remove("modal-in"),maskEl.classList.remove("modal-in")}},{key:"distory",value:function(){this.innerEl.parentNode.removeChild(this.innerEl),this.innerEl=null,this.events.trigger("distory"),_uiUtil.Events.trigger("ct-popup-event-distory",this)}},{key:"onInnerElTransitionend",value:function(){this.isShow?((prePopup=this).events.trigger("aftershow"),_uiUtil.Events.trigger("ct-popup-event-aftershow",this)):(prePopup=null,this.innerEl.style.display="none",this.events.trigger("afterclose"),_uiUtil.Events.trigger("ct-popup-event-afterclose",this))}},{key:"onMaskElTransitionend",value:function(){this.isShow||(maskEl.style.display="none")}},{key:"isDistory",value:function(){return!this.innerEl}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"off",value:function(e,t){e?t?this.events.remove(e,t):this.events.clear(e):this.events.clearAll()}},{key:"getId",value:function(){return this.id}}]),i}(),PopupFactory={create:function(e,t){return new Popup(e,t)},show:function(e){return!!e&&(!e.isDistory()&&(e!==prePopup&&((!prePopup||e.getId()!==prePopup.getId())&&void e.show())))},close:function(e){return!!e&&(!e.isDistory()&&void e.close())},closeAll:function(){prePopup&&this.close(prePopup)},distory:function(e){return!!e&&(!e.isDistory()&&void e.distory())},getEl:function(){return el},setEl:function(e){el=e}};CaptureElement();var _default=PopupFactory;exports.default=_default;
//# sourceMappingURL=popup.js.map
