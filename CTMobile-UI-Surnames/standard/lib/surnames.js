"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_uiUtil=require("@ctmobile/ui-util"),selectorPrefix="ct-surnames-",duration=100;function initVar(){this.highlightedEl=this.el.querySelector(".".concat(selectorPrefix,"highlighted")),this.indexEl=this.el.querySelector(".".concat(selectorPrefix,"index")),this.contentEl=this.el.querySelector(".".concat(selectorPrefix,"content"))}function clickDetail(e){var t=e.target;if(e.preventDefault(),this.key)return!1;this.key=!0,this.maskEl.style.display="block",_scrollToAnimation.call(this,t.dataset.name)}function moveDetail(e,t){var i=findIndex.call(this,e,t);if(i){if(console.log(i.name),this.highlightedEl.innerText=i.name,this.highlightedEl.style.display="block","vertical"===getDirection.call(this)){var n=i.offsetTop-Math.floor(i.height/2);this.highlightedEl.style.transform="translate3d(0,".concat(n,"px,0)")}else{var l=i.offsetLeft-i.width;this.highlightedEl.style.transform="translate3d(".concat(l,"px,0,0)")}_scrollTo.call(this,i.name)}}function initEvent(){var n=this;_uiUtil.Dom6.isTouch()?(this.indexEl.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),clickDetail.call(n,e)}),this.indexEl.addEventListener("touchmove",function(e){e.preventDefault();var t=e.changedTouches[0].clientY,i=e.changedTouches[0].clientX;moveDetail.call(n,i,t)}),this.indexEl.addEventListener("touchend",function(){n.highlightedEl.style.display="none",n.highlightedEl.innerText="",n.highlightedEl.style.transform="translate3d(0,0,0)"})):(this.indexEl.addEventListener("mousedown",function(e){e.preventDefault(),n.startY=e.clientY,n.startX=e.clientX,n.mouseClickFlag=!0}),this.indexEl.addEventListener("mousemove",function(e){if(!n.mouseClickFlag)return!1;n.mouseMoveFlag=!0,e.preventDefault();var t=e.clientY,i=e.clientX;moveDetail.call(n,i,t)}),this.indexEl.addEventListener("mouseleave",function(){n.mouseClickFlag=!1,n.mouseMoveFlag=!1,n.highlightedEl.style.display="none",n.highlightedEl.innerText="",n.highlightedEl.style.transform="translate3d(0,0,0)"}),this.indexEl.addEventListener("mouseup",function(e){if(n.mouseMoveFlag)return n.mouseClickFlag=!1,n.mouseMoveFlag=!1,n.highlightedEl.style.display="none",n.highlightedEl.innerText="",!(n.highlightedEl.style.transform="translate3d(0,0,0)");e.preventDefault(),clickDetail.call(n,e)})),window.addEventListener("resize",function(){n.update()})}function render(){var e=this.config.position,t=void 0===e?"right":e;_uiUtil.Dom6.addClass(this.el,"".concat(selectorPrefix,"config-position-").concat(t)),renderIndex.call(this),createIndexPosition.call(this)}function renderIndex(){var e=this.contentEl.querySelectorAll(".".concat(selectorPrefix,"group-title"));if(0===e.length)return!1;for(var t=[],i=0;i<e.length;i++)t.push(e[i].dataset.name);this.indexEl.innerHTML="";for(var n=document.createDocumentFragment(),l=0;l<t.length;l++)n.appendChild(_uiUtil.Dom6.createElement('<a class="'.concat(selectorPrefix,'index-item" data-name="').concat(t[l],'">').concat(t[l],"</a>")));this.indexEl.appendChild(n)}function createIndexPosition(){var e=this.indexEl.querySelectorAll(".".concat(selectorPrefix,"index-item"));this.indexPositionMap=[];for(var t=0;t<e.length;t++){var i=e[t],n=i.dataset.name,l=i.getBoundingClientRect();this.indexPositionMap.push({name:n,top:l.top,bottom:l.bottom,left:l.left,right:l.right,offsetTop:i.offsetTop,offsetLeft:i.offsetLeft,width:i.offsetWidth,height:i.offsetHeight})}}function createMask(){this.maskEl=_uiUtil.Dom6.createElement("<div class='".concat(selectorPrefix,"mask'></div>")),document.body.appendChild(this.maskEl)}function _scrollToAnimation(i){var n=this,e=n.contentEl.querySelector(".".concat(selectorPrefix,"group-title[data-name='").concat(i,"']")),l=n.contentEl.scrollTop,o=l,a=e.offsetTop,s=n.el.scrollHeight/(duration/(screen.updateInterval||16.7)+(duration%(screen.updateInterval||16.7)!=0?1:0));this.events.trigger("scrollBefore",i),window.requestAnimationFrame(function e(){function t(){n.key=!1,n.mouseClickFlag=!1,n.maskEl.style.display="none",n.events.trigger("scroll",i)}l<a?a<o+s?o=a:o+=s:o-s<a?o=a:o-=s,n.contentEl.scrollTop=o,l<a?a<=o?t():window.requestAnimationFrame(e):o<=a?t():window.requestAnimationFrame(e)})}function _scrollTo(e){var t=this.contentEl.querySelector(".".concat(selectorPrefix,"group-title[data-name='").concat(e,"']")).offsetTop;this.contentEl.scrollTop=t,this.events.trigger("scroll",e)}function findIndex(e,t){for(var i,n,l=getDirection.call(this),o="vertical"===l?t:e,a=0,s=this.indexPositionMap.length-1;a<=s&&a<=this.indexPositionMap.length-1&&s<=this.indexPositionMap.length-1;){i=s+a>>1;var r=this.indexPositionMap[i],c=void 0,h=void 0;if(h="vertical"===l?(c=r.top,r.bottom):(c=r.left,r.right),c<=o&&o<h){n=r;break}o<c?s=i-1:a=1+i}return n||null}function getDirection(){var e=this.config.position;return"left"===e||"right"===e?"vertical":"horizontal"}var Surnames=function(){function i(e,t){(0,_classCallCheck2.default)(this,i),this.el=e,this.config=Object.assign({position:"right"},t),this.key=!1,this.mouseClickFlag=!1,this.mouseMoveFlag=!1,this.events=new _uiUtil.Events,initVar.call(this),initEvent.call(this),createMask.call(this),render.call(this)}return(0,_createClass2.default)(i,[{key:"scrollToAnimation",value:function(e){_scrollToAnimation.call(this,e)}},{key:"scrollTo",value:function(e){_scrollTo.call(this,e)}},{key:"update",value:function(){renderIndex.call(this),createIndexPosition.call(this)}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"off",value:function(e,t){e?t?this.events.remove(e,t):this.events.clear(e):this.events.clearAll()}}]),i}(),SurnamesFactory={create:function(e,t){return new Surnames(e,t)}},_default=SurnamesFactory;exports.default=_default;
//# sourceMappingURL=surnames.js.map
